{"version":3,"sources":["app/common/a_star.js","app/common/color.js","app/common/components/active_checkbox.jsx","app/common/components/collapsible_panel.jsx","app/common/components/input_spinner.jsx","app/common/util.js","app/common/voronoi_diagram.js","app/experimental/basic_drawer.js","app/experimental/components/app.jsx","app/experimental/components/debug_info.jsx","app/experimental/components/sample_preview.jsx","app/experimental/components/samples_collection.jsx","app/experimental/luna.js","app/experimental/moving_arrows.js","app/experimental/orbits.js","app/experimental/planet.js","app/experimental/planets_focus.js","app/experimental/rule_30.js","app/experimental/samples_collection_init.js","app/experimental/tableau.js","app/experimental/tableau_smooth.js","app/experimental/texture_generators/blur_generator.js","app/experimental/texture_generators/density_map.js","app/experimental/texture_generators/links.js","app/experimental/texture_generators/points_in_circle.js","app/geo/balls_generator.js","app/geo/components/app.jsx","app/geo/components/debug_info.jsx","app/geo/components/drawing_settings_form.jsx","app/geo/components/generate_world_form.jsx","app/geo/components/legend.jsx","app/geo/components/roads_form.jsx","app/geo/game.js","app/geo/geo.js","app/geo/interaction.js","app/geo/map_drawer.js","app/geo/regions_gatherer.js","app/geo/rivers_and_lakes_generator.js","app/geo/rrt_diagram.js","app/geo/texture_generator.js","app/planets/components/app.jsx","app/planets/components/debug_info.jsx","app/planets/components/generate_world_form.jsx","app/planets/game.js","app/planets/interaction.js","app/planets/map_drawer.js","app/planets/star_system.js","app/planets/stellar_body.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnJA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/HA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5DA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxEA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhGA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/OA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjMA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzJA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlIA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3EA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5FA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjHA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApHA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1IA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhHA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5IA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhLA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/GA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnBA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxIA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvEA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlGA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjLA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxKA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7HA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhEA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnIA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3EA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArFA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3FA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhDA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1DA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtHA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxQA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjLA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApdA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvLA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5HA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlTA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlDA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3GA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3EA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5EA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlFA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApHA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApIA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/EA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/BA;AAAA","file":"public/app.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/**\n *  @param function getNeighboursFunc(point) -> [{point: neighbourPoint, weight: integer() | float()}]\n *    return list of all neighbours points with weight to move from given point to it\n *  @param function euristicFunc(pointFrom, pointTo) -> integer() | float()\n *    return estimated distance between two points\n *    for square map its a\n *    Math.abs(pointFrom.location.x - pointTo.location.x) + Math.abs(pointFrom.location.y - pointTo.location.y)\n *    for graphs without any coords representation its a very complicated task, suppose return just 0 (zero)\n *  @param int|float euristicWeight -- euristic distance weight multiplier\n *    you can set it to standard weight of one vertical|horisontal move\n */\nvar AStar = function () {\n  function AStar(getNeighboursFunc) {\n    var euristicFunc = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    var euristicWeight = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n    var pointIndexFunc = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n\n    _classCallCheck(this, AStar);\n\n    this.getNeighboursFunc = getNeighboursFunc;\n    this.euristicFunc = euristicFunc ? euristicFunc : AStar.standardEuristic;\n    this.euristicWeight = euristicWeight;\n    this.pointIndexFunc = pointIndexFunc;\n  }\n\n  _createClass(AStar, [{\n    key: 'find',\n    value: function find(startPoint, finishPoint) {\n      var openList = {},\n          closedList = {};\n      this.addToOpenList(startPoint, 0, null, openList);\n      this.counter = 0; // TEMP\n      return this.step(openList, closedList, finishPoint);\n    }\n  }, {\n    key: 'step',\n    value: function step(openList, closedList, finishPoint) {\n      this.counter++;\n      if (this.counter > 10000) {\n        throw 'counter overflow';\n      }\n      if (this.openListIsEmpty(openList)) {\n        return false; // no way to finish\n      }\n      var pointObj = this.popPointFromOpenList(openList);\n      // TODO -- preferable way is diagonal. do it some way\n      var neighbours = this.getNeighboursFunc(pointObj.point);\n      for (var i = 0; i < neighbours.length; i++) {\n        var e = neighbours[i];\n        var weight = e.weight + pointObj.weight + this.euristicWeight * this.euristicFunc(e.point, finishPoint);\n\n        if (e.point == finishPoint) {\n          var path = [e.point, pointObj.point],\n              iPointObj = pointObj;\n          while (iPointObj.parent != null) {\n            path.push(iPointObj.parent.point);\n            iPointObj = iPointObj.parent;\n          }\n          return path;\n        } else if (this.checkPointInClosedList(e, closedList)) {\n          // just do nothing\n        } else {\n          var foundInOpenList = this.getFromOpenList(e, openList);\n          if (foundInOpenList) {\n            foundInOpenList.parent = pointObj;\n            foundInOpenList.weight = weight;\n          } else {\n            this.addToOpenList(e.point, weight, pointObj, openList);\n          }\n        }\n      }\n      this.addToClosedList(pointObj, closedList);\n      return this.step(openList, closedList, finishPoint);\n    }\n\n    // TODO -- its a hack -- we suggest some imput data structure\n    // TODO -- change the whole func to call to this.pointIndexFunc thru all code\n\n  }, {\n    key: 'listKey',\n    value: function listKey(pointObj) {\n      if (this.pointIndexFunc) {\n        return this.pointIndexFunc(pointObj.point);\n      }\n      return pointObj.point.location.x + '|' + pointObj.point.location.y;\n    }\n  }, {\n    key: 'addToOpenList',\n    value: function addToOpenList(point, pointWeight, parentPointObj, openList) {\n      var pointObj = { point: point, weight: pointWeight, parent: parentPointObj };\n      openList[this.listKey(pointObj)] = pointObj;\n    }\n  }, {\n    key: 'openListIsEmpty',\n    value: function openListIsEmpty(openList) {\n      return Object.keys(openList).length == 0;\n    }\n  }, {\n    key: 'getFromOpenList',\n    value: function getFromOpenList(pointObj, openList) {\n      return openList[this.listKey(pointObj)];\n    }\n  }, {\n    key: 'popPointFromOpenList',\n    value: function popPointFromOpenList(openList) {\n      var cur = {},\n          index = void 0;\n      for (var i in openList) {\n        if (openList[i].weight < cur.weight || !cur.weight) {\n          cur = openList[i];\n          index = i;\n        }\n      }\n      delete openList[index];\n      return cur;\n    }\n  }, {\n    key: 'addToClosedList',\n    value: function addToClosedList(pointObj, closedList) {\n      closedList[this.listKey(pointObj)] = pointObj;\n    }\n  }, {\n    key: 'checkPointInClosedList',\n    value: function checkPointInClosedList(pointObj, closedList) {\n      return closedList[this.listKey(pointObj)] != undefined;\n    }\n  }], [{\n    key: 'standardEuristic',\n    value: function standardEuristic(pointFrom, pointTo) {\n      return Math.abs(pointFrom.x - pointTo.x) + Math.abs(pointFrom.y - pointTo.y);\n    }\n  }]);\n\n  return AStar;\n}();\n\nexports.default = AStar;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Color = function () {\n  function Color() {\n    _classCallCheck(this, Color);\n  }\n\n  _createClass(Color, null, [{\n    key: \"random_near\",\n    value: function random_near(_ref) {\n      var _ref2 = _slicedToArray(_ref, 3),\n          r = _ref2[0],\n          g = _ref2[1],\n          b = _ref2[2];\n\n      var step = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 10;\n      var count = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 2;\n\n      return Color.for_rgb([r, g, b], function (e) {\n        return Color.random_channel(e, step, count);\n      });\n    }\n  }, {\n    key: \"random\",\n    value: function random(_ref3) {\n      var _ref4 = _slicedToArray(_ref3, 3),\n          r = _ref4[0],\n          g = _ref4[1],\n          b = _ref4[2];\n\n      var step = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 10;\n\n      return Color.for_rgb([r, g, b], function (e) {\n        return Color.random_by_floor(e, step);\n      });\n    }\n  }, {\n    key: \"brighter\",\n    value: function brighter(_ref5) {\n      var _ref6 = _slicedToArray(_ref5, 3),\n          r = _ref6[0],\n          g = _ref6[1],\n          b = _ref6[2];\n\n      var step = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 10;\n\n      return [r, g, b].map(function (e) {\n        return Math.min(e + step, 255);\n      });\n    }\n  }, {\n    key: \"darker\",\n    value: function darker(_ref7) {\n      var _ref8 = _slicedToArray(_ref7, 3),\n          r = _ref8[0],\n          g = _ref8[1],\n          b = _ref8[2];\n\n      var step = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 10;\n\n      return [r, g, b].map(function (e) {\n        return Math.max(e - step, 0);\n      });\n    }\n  }, {\n    key: \"to_pixi\",\n    value: function to_pixi(_ref9) {\n      var _ref10 = _slicedToArray(_ref9, 3),\n          r = _ref10[0],\n          g = _ref10[1],\n          b = _ref10[2];\n\n      return (r << 16) + (g << 8) + b;\n    }\n\n    // PRIVATE\n\n  }, {\n    key: \"for_rgb\",\n    value: function for_rgb(_ref11, func) {\n      var _ref12 = _slicedToArray(_ref11, 3),\n          r = _ref12[0],\n          g = _ref12[1],\n          b = _ref12[2];\n\n      return [func(r), func(g), func(b)];\n    }\n\n    // PRIVATE\n\n  }, {\n    key: \"random_channel\",\n    value: function random_channel(base, step, count) {\n      var rand = step * _util2.default.rand(-count, count);\n      var res = base + rand;\n      return res > 255 ? 255 : res < 0 ? 0 : res;\n    }\n\n    // PRIVATE\n\n  }, {\n    key: \"random_by_floor\",\n    value: function random_by_floor(floor, step) {\n      return floor - step * _util2.default.rand(0, floor / step | 0);\n    }\n  }]);\n\n  return Color;\n}();\n\nexports.default = Color;\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar ActiveCheckbox = function (_React$Component) {\n  _inherits(ActiveCheckbox, _React$Component);\n\n  function ActiveCheckbox(props) {\n    _classCallCheck(this, ActiveCheckbox);\n\n    var _this = _possibleConstructorReturn(this, (ActiveCheckbox.__proto__ || Object.getPrototypeOf(ActiveCheckbox)).call(this, props));\n\n    _this.state = { checked: props.checked };\n    console.log('SUKA', _this.state);\n    return _this;\n  }\n\n  _createClass(ActiveCheckbox, [{\n    key: 'handler',\n    value: function handler(event) {\n      var value = this.props.handler(event);\n      this.setState({ checked: value });\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      return _react2.default.createElement(\n        'div',\n        { className: 'form-check' },\n        _react2.default.createElement(\n          'label',\n          { className: 'form-check-label' },\n          _react2.default.createElement('input', { className: 'form-check-input', type: 'checkbox', onChange: this.handler.bind(this), defaultChecked: this.state.checked }),\n          '\\xA0',\n          this.props.text\n        )\n      );\n    }\n  }]);\n\n  return ActiveCheckbox;\n}(_react2.default.Component);\n\nexports.default = ActiveCheckbox;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = require(\"react\");\n\nvar _react2 = _interopRequireDefault(_react);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar CollapsiblePanel = function (_React$Component) {\n  _inherits(CollapsiblePanel, _React$Component);\n\n  function CollapsiblePanel(args) {\n    _classCallCheck(this, CollapsiblePanel);\n\n    var _this = _possibleConstructorReturn(this, (CollapsiblePanel.__proto__ || Object.getPrototypeOf(CollapsiblePanel)).call(this));\n\n    _this.header = args.header;\n    _this.name = args.name;\n    _this.content_func = args.content_func;\n    return _this;\n  }\n\n  _createClass(CollapsiblePanel, [{\n    key: \"render\",\n    value: function render() {\n      return _react2.default.createElement(\n        \"div\",\n        { className: \"panel panel-success\" },\n        _react2.default.createElement(\n          \"div\",\n          { className: \"panel-heading\" },\n          _react2.default.createElement(\n            \"h4\",\n            { className: \"panel-title\" },\n            _react2.default.createElement(\n              \"a\",\n              { \"data-toggle\": \"collapse\", href: '#' + this.name },\n              this.header,\n              \" \",\n              _react2.default.createElement(\"span\", { className: \"caret\" })\n            )\n          )\n        ),\n        _react2.default.createElement(\n          \"div\",\n          { id: this.name, className: \"panel-collapse collapse\" },\n          _react2.default.createElement(\n            \"div\",\n            { className: \"panel-body\" },\n            this.content_func()\n          )\n        )\n      );\n    }\n  }]);\n\n  return CollapsiblePanel;\n}(_react2.default.Component);\n\nexports.default = CollapsiblePanel;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = require(\"react\");\n\nvar _react2 = _interopRequireDefault(_react);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar InputSpinner = function (_React$Component) {\n  _inherits(InputSpinner, _React$Component);\n\n  function InputSpinner(args) {\n    _classCallCheck(this, InputSpinner);\n\n    var _this = _possibleConstructorReturn(this, (InputSpinner.__proto__ || Object.getPrototypeOf(InputSpinner)).call(this, args));\n\n    _this.state = { value: args.value };\n    _this.name = args.name;\n    _this.min = args.min ? args.min : 0;\n    _this.max = args.max ? args.max : Infinity;\n    return _this;\n  }\n\n  _createClass(InputSpinner, [{\n    key: \"click_up\",\n    value: function click_up(e) {\n      if (this.state.value >= this.max) {\n        return false;\n      }\n      this.update_value(this.state.value + 1);\n      e.preventDefault();\n    }\n  }, {\n    key: \"click_down\",\n    value: function click_down(e) {\n      if (this.state.value <= this.min) {\n        return false;\n      }\n      this.update_value(this.state.value - 1);\n      e.preventDefault();\n    }\n  }, {\n    key: \"manual_set\",\n    value: function manual_set(e) {\n      this.update_value(e.target.value);\n    }\n  }, {\n    key: \"update_value\",\n    value: function update_value(new_value) {\n      this.setState({ value: new_value });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return _react2.default.createElement(\n        \"div\",\n        { className: \"input-group\" },\n        _react2.default.createElement(\n          \"span\",\n          { className: \"input-group-btn\" },\n          _react2.default.createElement(\n            \"a\",\n            { className: \"btn btn-danger\", onClick: this.click_down.bind(this) },\n            _react2.default.createElement(\"span\", { className: \"glyphicon glyphicon-minus\" })\n          )\n        ),\n        _react2.default.createElement(\"input\", { id: this.name, type: \"text\", className: \"form-control text-center\", value: this.state.value, onChange: this.manual_set.bind(this) }),\n        _react2.default.createElement(\n          \"span\",\n          { className: \"input-group-btn\" },\n          _react2.default.createElement(\n            \"a\",\n            { className: \"btn btn-info\", onClick: this.click_up.bind(this) },\n            _react2.default.createElement(\"span\", { className: \"glyphicon glyphicon-plus\" })\n          )\n        )\n      );\n    }\n  }]);\n\n  return InputSpinner;\n}(_react2.default.Component);\n\nexports.default = InputSpinner;\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Util = function () {\n  function Util() {\n    _classCallCheck(this, Util);\n  }\n\n  _createClass(Util, null, [{\n    key: 'exec_in_cycle_with_delay',\n    value: function exec_in_cycle_with_delay(index, limit, delay, func) {\n      var final_func = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : function () {};\n\n      if (typeof limit === \"function\" && !limit() || index >= limit) {\n        final_func(index);\n        return;\n      }\n      func(index);\n      setTimeout(function () {\n        Util.exec_in_cycle_with_delay(index + 1, limit, delay, func, final_func);\n      }, delay);\n    }\n  }, {\n    key: 'rand',\n    value: function rand(min, max) {\n      return Math.floor(Math.random() * (max - min + 1) + min);\n    }\n  }, {\n    key: 'rand_element',\n    value: function rand_element(arr) {\n      if (arr.length == 0) return false;\n      return arr[Util.rand(0, arr.length - 1)];\n    }\n  }, {\n    key: 'rand_float',\n    value: function rand_float(min, max) {\n      return Math.random() * (max - min) + min;\n    }\n  }, {\n    key: 'normalize_value',\n    value: function normalize_value(value, max, normal_max) {\n      var min = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n      var normal_min = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;\n\n      if (value > max || value < min) {\n        console.log('value out of range', value, max, normal_max, min, normal_min);\n        throw 'value out of range';\n      }\n      return (value - min) * (normal_max - normal_min) / (max - min) + normal_min;\n    }\n\n    ///////////////////////////////////\n    // ARRAYS\n    ///////////////////////////////////\n\n  }, {\n    key: 'last',\n    value: function last(array) {\n      return array.length == 0 ? false : array[array.length - 1];\n    }\n  }, {\n    key: 'push_uniq',\n    value: function push_uniq(element, arr) {\n      if (arr.indexOf(element) == -1) {\n        arr.push(element);\n      }\n    }\n  }, {\n    key: 'merge',\n    value: function merge(arr1, arr2) {\n      arr2.forEach(function (e) {\n        return Util.push_uniq(e, arr1);\n      });\n    }\n  }, {\n    key: 'remove_element',\n    value: function remove_element(element, arr) {\n      var index = arr.indexOf(element);\n      if (index !== -1) {\n        arr.splice(index, 1);\n        return true;\n      }\n      return false;\n    }\n  }, {\n    key: 'for_all_consecutive_pairs',\n    value: function for_all_consecutive_pairs(array, fun) {\n      if (array.length < 2) {\n        return false;\n      }\n      for (var i = 0; i < array.length; i++) {\n        var cur = array[i];\n        var next_index = i + 1 == array.length ? 0 : i + 1;\n        var next = array[next_index];\n        fun(cur, next, i, next_index);\n      }\n    }\n  }, {\n    key: 'find_min_and_max',\n    value: function find_min_and_max(array, value_func) {\n      if (!array.length) return false;\n      var ret = { min: null, max: null, min_element: null, max_element: null };\n      array.forEach(function (e) {\n        var res = value_func(e);\n        if (isNaN(res) || res === null) return;\n        if (ret.min == null || ret.max == null) {\n          ret.min = res;\n          ret.max = res;\n          ret.min_element = e;\n          ret.max_element = e;\n          return;\n        }\n        if (res < ret.min) {\n          ret.min = res;\n          ret.min_element = e;\n        }\n        if (res > ret.max) {\n          ret.max = res;\n          ret.max_element = e;\n        }\n      });\n      return ret;\n    }\n\n    // ??? experimental. some standard routine for cyclic open_list processing\n\n  }, {\n    key: 'do_while_not_empty',\n    value: function do_while_not_empty(open_list, func) {\n      var length_before = void 0,\n          step = 0;\n      do {\n        length_before = open_list.length;\n        open_list = open_list.filter(function (element) {\n          return !func(element, step++);\n        });\n        if (length_before == open_list.length) {\n          console.log('do_while_not_empty() open_list length not chenged, bailing out', length_before, open_list);\n          return false;\n        }\n      } while (open_list.length);\n      return true;\n    }\n\n    //////////////////////////////////////////\n    // geometry\n    //////////////////////////////////////////\n\n  }, {\n    key: 'to_polar_coords',\n    value: function to_polar_coords(x, y) {\n      var radius = Math.sqrt(x * x + y * y);\n      var angle = Math.atan2(y, x);\n      return { angle: angle, radius: radius };\n    }\n  }, {\n    key: 'from_polar_coords',\n    value: function from_polar_coords(angle, radius) {\n      var x = radius * Math.cos(angle);\n      var y = radius * Math.sin(angle);\n      return { x: x, y: y };\n    }\n  }, {\n    key: 'radians',\n    value: function radians(degrees) {\n      return degrees * Math.PI / 180;\n    }\n  }, {\n    key: 'degrees',\n    value: function degrees(radians) {\n      return radians * 180 / Math.PI;\n    }\n  }, {\n    key: 'angles_diff',\n    value: function angles_diff(a, b) {\n      var diff = Math.abs(a - b);\n      return Math.min(diff, 2 * Math.PI - diff);\n    }\n  }, {\n    key: 'move_by_vector',\n    value: function move_by_vector(from, to, length) {\n      // why i wrote j_max + 1? thats for last gradient area -- otherwise it will be just a single dot\n      return { x: from.x + (to.x - from.x) * length, y: from.y + (to.y - from.y) * length };\n    }\n  }, {\n    key: 'convex_polygon_centroid',\n    value: function convex_polygon_centroid(points) {\n      var p1 = points[0];\n      var square_sum = 0;\n      var xc = 0,\n          yc = 0;\n      for (var i = 1; i < points.length - 1; i++) {\n        var p2 = points[i];\n        var p3 = points[i + 1];\n        var square = ((p1.x - p3.x) * (p2.y - p3.y) - (p2.x - p3.x) * (p1.y - p3.y)) / 2; // triangle square\n        square_sum += square;\n        xc += square * (p1.x + p2.x + p3.x) / 3;\n        yc += square * (p1.y + p2.y + p3.y) / 3;\n      }\n      return { x: xc / square_sum, y: yc / square_sum };\n    }\n\n    // points should be sorted by angle to center!!!\n\n  }, {\n    key: 'convex_polygon_square',\n    value: function convex_polygon_square(points) {\n      var p1 = points[0];\n      var square = 0;\n      for (var i = 1; i < points.length - 1; i++) {\n        var p2 = points[i];\n        var p3 = points[i + 1];\n        square += Math.abs((p1.x - p3.x) * (p2.y - p3.y) - (p2.x - p3.x) * (p1.y - p3.y)) / 2;\n      }\n      return square;\n    }\n  }, {\n    key: 'distance',\n    value: function distance(p1, p2) {\n      return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));\n    }\n  }, {\n    key: 'gauss_function',\n    value: function gauss_function(x, sigma, mu) {\n      return 1 / (sigma * Math.sqrt(2 * Math.PI)) * Math.pow(Math.E, -(Math.pow(x - mu, 2) / (2 * Math.pow(sigma, 2))));\n    }\n  }]);\n\n  return Util;\n}();\n\nexports.default = Util;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _d = require(\"d3\");\n\nvar d3 = _interopRequireWildcard(_d);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/**\n *  we take original voronoi diagram from d3,\n *  add lloyd relaxation\n *  and then reorganize its internal structure, cause its annoying and awful, for my taste\n *  and to each cell we add array of links to neig nodes, sorted by distance\n */\nvar VoronoiDiagram = function () {\n  function VoronoiDiagram() {\n    _classCallCheck(this, VoronoiDiagram);\n  }\n\n  _createClass(VoronoiDiagram, null, [{\n    key: \"generate\",\n    value: function generate(nodes, width, height) {\n      var lloyd_relaxation_steps = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n\n      var voronoi = d3.voronoi().x(function (p) {\n        return p.x;\n      }).y(function (p) {\n        return p.y;\n      }).size([width, height]);\n      var original_diagram = voronoi(nodes);\n      for (var i = 0; i < lloyd_relaxation_steps; i++) {\n        original_diagram = VoronoiDiagram.lloyd_relaxation(original_diagram, voronoi);\n      }\n      var diagram = {};\n      // rewrite edges and nodes\n      // the problem with original d3 diagram is not only that node is array(2), but also is that\n      // it has nodes duplicates! we are to \"regather\" all nodes\n      diagram.nodes = [];\n      diagram.edges = original_diagram.edges.map(function (edge) {\n        var node_from = void 0,\n            node_to = void 0;\n        diagram.nodes.forEach(function (node) {\n          if (VoronoiDiagram.seems_like_nodes_are_equal(node, edge[0])) {\n            node_from = node;\n          }\n          if (VoronoiDiagram.seems_like_nodes_are_equal(node, edge[1])) {\n            node_to = node;\n          }\n        });\n        if (!node_from) {\n          node_from = { x: edge[0][0], y: edge[0][1], cells: [], links: [] };\n          diagram.nodes.push(node_from);\n        }\n        if (!node_to) {\n          node_to = { x: edge[1][0], y: edge[1][1], cells: [], links: [] };\n          diagram.nodes.push(node_to);\n        }\n        //node_from.links.push(node_to);\n        _util2.default.push_uniq(node_to, node_from.links);\n        node_to.links.push(node_from);\n        _util2.default.push_uniq(node_from, node_to.links);\n\n        _util2.default.push_uniq(edge.left.data, node_from.cells);\n        _util2.default.push_uniq(edge.left.data, node_to.cells);\n        if (edge.right) {\n          _util2.default.push_uniq(edge.right.data, node_from.cells);\n          _util2.default.push_uniq(edge.right.data, node_to.cells);\n        }\n        return {\n          from: node_from,\n          to: node_to,\n          left: edge.left.data,\n          right: edge.right ? edge.right.data : undefined\n        };\n      });\n      // rewrite cells\n      diagram.cells = original_diagram.cells.map(function (orig_cell) {\n        var cell = orig_cell.site.data; // original object!!! and we change it here!!!\n        cell.nodes = diagram.nodes.filter(function (node) {\n          return node.cells.indexOf(cell) != -1;\n        });\n        cell.nodes.sort(function (n1, n2) {\n          var angle1 = _util2.default.to_polar_coords(n1.x - cell.x, n1.y - cell.y).angle;\n          var angle2 = _util2.default.to_polar_coords(n2.x - cell.x, n2.y - cell.y).angle;\n          return angle1 - angle2;\n        });\n        cell.halfedges = orig_cell.halfedges;\n        cell.index = orig_cell.site.index;\n        // !!! we rewrite origin coordinates that COULD change (after lloyd relaxation)\n        cell.x = orig_cell.site[0];\n        cell.y = orig_cell.site[1];\n        return cell;\n      });\n      diagram.cells.forEach(function (cell) {\n        var links = [];\n        cell.halfedges.forEach(function (halfedge_index) {\n          var halfedge = diagram.edges[halfedge_index];\n          var link_site = halfedge.left == cell ? halfedge.right : halfedge.left;\n          // near-border halfedges dont have right or left cell \n          if (!link_site) {\n            return;\n          }\n          _util2.default.push_uniq(diagram.cells[link_site.index], links);\n        });\n        // links sorted by distance -- from lowest to highest!\n        links.sort(function (e1, e2) {\n          return _util2.default.distance(cell, e1) - _util2.default.distance(cell, e2);\n        });\n        cell.links = links;\n      });\n      diagram.width = width;\n      diagram.height = height;\n\n      // final checks\n      diagram.nodes.forEach(function (node) {\n        /* its normal -- 4 or more nodes lie on circle\n        if (node.links.length > 3) {\n          console.log(\"ITS TOTAL DISASTER\", node.x, node.y);\n          node.links.forEach(e => console.log(\"DISASTER\", e.x, e.y));\n          //throw('ITS TOTAL DISASTER voronoi diagram');\n        }\n        */\n        if (node.links.length < 2) {\n          console.log(\"a little split\", node.x, node.y, node.links);\n          throw 'ITS TOTAL DISASTER voronoi diagram';\n        }\n        /* its normal too\n        if (node.cells.length > 3 || node.cells.length == 0) {\n          console.log(\"BAD cells\", node.x, node.y, node.cells.length);\n          //throw('ITS TOTAL DISASTER voronoi diagram');\n        }\n        */\n      });\n\n      return diagram;\n    }\n\n    // TODO binary tree search\n\n  }, {\n    key: \"find\",\n    value: function find(point, diagram) {\n      return _util2.default.find_min_and_max(diagram.cells, function (e) {\n        return _util2.default.distance(point, e);\n      }).min_element;\n    }\n  }, {\n    key: \"lloyd_relaxation\",\n    value: function lloyd_relaxation(diagram, voronoi) {\n      var to_move = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n\n      var new_points = diagram.polygons().map(function (p) {\n        // well, its not real lloyd relaxation, we move new cell center not to centroid, but move\n        // it by value of 'to_move' to direction to centroid\n        var poly = p.map(function (e) {\n          return { x: e[0], y: e[1] };\n        });\n        var pf = _util2.default.convex_polygon_centroid(poly);\n        return _util2.default.move_by_vector(p.data, pf, to_move);\n      });\n      return voronoi(new_points);\n    }\n\n    // PRIVATE. TRY to heal shizophrenia -- different, but very close nodes\n    // but it can lead us to total \n\n  }, {\n    key: \"seems_like_nodes_are_equal\",\n    value: function seems_like_nodes_are_equal(node, old_node) {\n      var very_close_is = 0.0000000000001;\n      return Math.abs(node.x - old_node[0]) < very_close_is && Math.abs(node.y - old_node[1]) < very_close_is;\n      //return node.x == old_node[0] && node.y == old_node[1];\n    }\n  }]);\n\n  return VoronoiDiagram;\n}();\n\nexports.default = VoronoiDiagram;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _color = require(\"common/color\");\n\nvar _color2 = _interopRequireDefault(_color);\n\nvar _d = require(\"d3\");\n\nvar d3 = _interopRequireWildcard(_d);\n\nvar _app = require(\"experimental/components/app\");\n\nvar _app2 = _interopRequireDefault(_app);\n\nvar _reactDom = require(\"react-dom\");\n\nvar _reactDom2 = _interopRequireDefault(_reactDom);\n\nvar _react = require(\"react\");\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _pixi = require(\"pixi.js\");\n\nvar PIXI = _interopRequireWildcard(_pixi);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar BasicDrawer = function () {\n  function BasicDrawer(regime) {\n    var _this = this;\n\n    _classCallCheck(this, BasicDrawer);\n\n    this.real_size = 800;\n    this.regime = regime;\n    this.ticks = 0;\n    this.tick_speed = 1;\n    this.react_app = _react2.default.createElement(_app2.default, { additional: this.update_debug_info() });\n    document.addEventListener('DOMContentLoaded', function () {\n      _reactDom2.default.render(_this.react_app, document.querySelector('#app'));\n      _this.init();\n    });\n  }\n\n  // TODO update debug info not directly, but from setState()\n\n\n  _createClass(BasicDrawer, [{\n    key: \"init\",\n    value: function init() {\n      var _this2 = this;\n\n      this.pixi = new PIXI.Application(this.real_size, this.real_size, {\n        backgroundColor: _color2.default.to_pixi([0, 0, 0]),\n        antialias: true,\n        view: document.getElementById('view')\n      });\n      this.pixi.stage.interactive = true; // ??\n      console.log('renderer', this.pixi.renderer);\n\n      this.base_container = new PIXI.Container();\n      if (this.regime == 'square') {\n        // square map is 100x100 size\n        this.size = 100;\n        var scale = this.real_size / this.size | 0;\n        this.base_container.scale = { x: scale, y: scale };\n      } else if (this.regime == 'circle') {\n        // circle map is circle with radils=100, coords from -100 to 100\n        this.size = 200;\n        var _scale = this.real_size / this.size | 0;\n        this.base_container.scale = { x: _scale, y: _scale };\n        this.base_container.position.x = this.real_size / 2 | 0;\n        this.base_container.position.y = this.real_size / 2 | 0;\n      } else if (!this.regime) {\n        throw 'regime is not set';\n      } else {\n        throw 'unknown regime: ' + regime;\n      }\n\n      this.pixi.stage.addChild(this.base_container);\n      document.getElementById('view_container').appendChild(this.pixi.view);\n\n      // copy-paste from Interation\n      document.addEventListener('mousemove', this.mouse_move_handler.bind(this), false);\n\n      this.ticks = 0; // here?\n      this.tick_time = 0;\n      this.pixi.ticker.add(function (delta) {\n        _this2.ticks++;\n        if (_this2.ticks % 10 == 0) {\n          d3.select('#fps_counter').html(_this2.pixi.ticker.FPS | 0);\n        }\n        _this2.tick_delta = delta;\n        _this2.tick_time += delta;\n        _this2.redraw();\n        _this2.update_debug_info().forEach(function (e) {\n          return document.getElementById(e.id).innerHTML = e.value;\n        });\n      });\n      //////////////////////////////////\n      this.init_graphics();\n    }\n  }, {\n    key: \"clear_all\",\n    value: function clear_all() {\n      this.base_container.removeChildren();\n    }\n  }, {\n    key: \"init_graphics\",\n    value: function init_graphics() {}\n  }, {\n    key: \"redraw\",\n    value: function redraw() {}\n  }, {\n    key: \"update_debug_info\",\n    value: function update_debug_info() {\n      return [];\n    }\n  }, {\n    key: \"mouse_move_handler\",\n    value: function mouse_move_handler(event) {\n      if (event.target != this.pixi.view) {\n        return false;\n      }\n      var mouse_coords = this.get_mouse_coords(event);\n      d3.select('#mouse_pos').html('{x: ' + mouse_coords.x + ', y: ' + mouse_coords.y + '}');\n    }\n  }, {\n    key: \"get_mouse_coords\",\n    value: function get_mouse_coords(event) {\n      return { x: event.offsetX, y: event.offsetY };\n    }\n  }]);\n\n  return BasicDrawer;\n}();\n\nexports.default = BasicDrawer;\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _debug_info = require('experimental/components/debug_info');\n\nvar _debug_info2 = _interopRequireDefault(_debug_info);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar App = function (_React$Component) {\n  _inherits(App, _React$Component);\n\n  function App(props) {\n    _classCallCheck(this, App);\n\n    var _this = _possibleConstructorReturn(this, (App.__proto__ || Object.getPrototypeOf(App)).call(this, props));\n\n    _this.state = { additional: props.additional ? props.additional : [] };\n    return _this;\n  }\n\n  // bad. but i dont care for now\n\n\n  _createClass(App, [{\n    key: 'go_back',\n    value: function go_back() {\n      window.location.href = \"./samples_collection.html\";\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      return _react2.default.createElement(\n        'div',\n        { className: 'panel-group' },\n        _react2.default.createElement(\n          'div',\n          { className: 'panel panel-success' },\n          _react2.default.createElement(\n            'div',\n            { className: 'panel-body' },\n            _react2.default.createElement(\n              'div',\n              { className: '', id: 'back_link' },\n              _react2.default.createElement(\n                'button',\n                { type: 'button', className: 'btn btn-success btn', onClick: this.go_back },\n                _react2.default.createElement('span', { className: 'glyphicon glyphicon-triangle-left', 'aria-hidden': 'true' }),\n                '\\xA0back to collection'\n              )\n            )\n          )\n        ),\n        _react2.default.createElement(\n          'div',\n          { className: 'panel panel-success' },\n          _react2.default.createElement(\n            'div',\n            { className: 'panel-body' },\n            _react2.default.createElement(\n              'div',\n              { className: '', id: 'view_container' },\n              _react2.default.createElement('canvas', { id: 'view', width: '800', height: '800' })\n            )\n          )\n        ),\n        _react2.default.createElement(\n          'div',\n          { className: 'panel panel-success' },\n          _react2.default.createElement(\n            'div',\n            { className: 'panel-body' },\n            _react2.default.createElement(\n              'div',\n              null,\n              _react2.default.createElement(\n                'div',\n                null,\n                'FPS: ',\n                _react2.default.createElement('span', { id: 'fps_counter' })\n              ),\n              _react2.default.createElement(\n                'div',\n                null,\n                'mouse position: ',\n                _react2.default.createElement(\n                  'span',\n                  { id: 'mouse_pos' },\n                  (0, 0)\n                )\n              ),\n              this.state.additional.map(function (e) {\n                return _react2.default.createElement(\n                  'div',\n                  { key: e.id },\n                  e.text,\n                  ': ',\n                  _react2.default.createElement(\n                    'span',\n                    { id: e.id },\n                    e.value\n                  )\n                );\n              })\n            )\n          )\n        )\n      );\n    }\n  }]);\n\n  return App;\n}(_react2.default.Component);\n\nexports.default = App;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = require(\"react\");\n\nvar _react2 = _interopRequireDefault(_react);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar DebugInfo = function (_React$Component) {\n  _inherits(DebugInfo, _React$Component);\n\n  function DebugInfo() {\n    _classCallCheck(this, DebugInfo);\n\n    return _possibleConstructorReturn(this, (DebugInfo.__proto__ || Object.getPrototypeOf(DebugInfo)).apply(this, arguments));\n  }\n\n  _createClass(DebugInfo, [{\n    key: \"render\",\n    value: function render() {\n      return _react2.default.createElement(\n        \"div\",\n        null,\n        _react2.default.createElement(\n          \"div\",\n          null,\n          \"FPS: \",\n          _react2.default.createElement(\"span\", { id: \"fps_counter\" })\n        ),\n        _react2.default.createElement(\n          \"div\",\n          null,\n          \"map scale: \",\n          _react2.default.createElement(\"span\", { id: \"map_scale\" })\n        ),\n        _react2.default.createElement(\n          \"div\",\n          null,\n          \"mouse position: \",\n          _react2.default.createElement(\n            \"span\",\n            { id: \"mouse_pos\" },\n            (0, 0)\n          )\n        ),\n        _react2.default.createElement(\n          \"div\",\n          null,\n          \"world point: \",\n          _react2.default.createElement(\n            \"span\",\n            { id: \"world_pos\" },\n            (0, 0)\n          )\n        )\n      );\n    }\n  }]);\n\n  return DebugInfo;\n}(_react2.default.Component);\n\nexports.default = DebugInfo;\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar SamplePreview = function (_React$Component) {\n  _inherits(SamplePreview, _React$Component);\n\n  function SamplePreview(props) {\n    _classCallCheck(this, SamplePreview);\n\n    var _this = _possibleConstructorReturn(this, (SamplePreview.__proto__ || Object.getPrototypeOf(SamplePreview)).call(this));\n\n    var valid_statuses = ['draft', 'in_progress', 'almost_ready', 'ready'];\n\n    if (!props.name || !props.description || !props.sample_url || !props.img_path || !props.status) {\n      console.log('some params missing', props);\n      throw 'some params missing';\n    }\n    if (valid_statuses.indexOf(props.status) == -1) {\n      console.log('wrong status', props.status);\n      throw 'wrong status';\n    }\n    _this.state = { status_text: props.status.replace(/_/g, ' ') };\n    return _this;\n  }\n\n  _createClass(SamplePreview, [{\n    key: 'render',\n    value: function render() {\n      return _react2.default.createElement(\n        'div',\n        { className: 'sample_preview' },\n        _react2.default.createElement(\n          'div',\n          { className: 'panel panel-success', style: { width: 220 } },\n          _react2.default.createElement(\n            'div',\n            { className: 'panel-heading' },\n            _react2.default.createElement(\n              'div',\n              { className: 'panel-title' },\n              this.props.name\n            ),\n            _react2.default.createElement(\n              'span',\n              { className: 'label label-primary status_' + this.props.status },\n              this.state.status_text\n            )\n          ),\n          _react2.default.createElement(\n            'div',\n            { className: 'panel-body' },\n            _react2.default.createElement(\n              'a',\n              { href: this.props.sample_url, className: 'thumbnail' },\n              _react2.default.createElement('img', { width: '200', height: '200', src: this.props.img_path })\n            ),\n            _react2.default.createElement(\n              'div',\n              { className: '' },\n              _react2.default.createElement(\n                'p',\n                null,\n                this.props.description\n              )\n            )\n          )\n        )\n      );\n    }\n  }]);\n\n  return SamplePreview;\n}(_react2.default.Component);\n\nexports.default = SamplePreview;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _sample_preview = require(\"experimental/components/sample_preview\");\n\nvar _sample_preview2 = _interopRequireDefault(_sample_preview);\n\nvar _react = require(\"react\");\n\nvar _react2 = _interopRequireDefault(_react);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar SamplesCollecton = function (_React$Component) {\n  _inherits(SamplesCollecton, _React$Component);\n\n  function SamplesCollecton() {\n    _classCallCheck(this, SamplesCollecton);\n\n    return _possibleConstructorReturn(this, (SamplesCollecton.__proto__ || Object.getPrototypeOf(SamplesCollecton)).apply(this, arguments));\n  }\n\n  _createClass(SamplesCollecton, [{\n    key: \"render\",\n    value: function render() {\n      return _react2.default.createElement(\n        \"div\",\n        { className: \"col-md-8 col-md-offset-2\" },\n        _react2.default.createElement(\n          \"div\",\n          { className: \"panel panel-success\" },\n          _react2.default.createElement(\n            \"div\",\n            { className: \"panel-heading\" },\n            _react2.default.createElement(\n              \"h4\",\n              { className: \"panel-title\" },\n              \"a collection of funny graphics samples\"\n            )\n          ),\n          _react2.default.createElement(\n            \"div\",\n            { className: \"panel-body\" },\n            _react2.default.createElement(_sample_preview2.default, {\n              name: 'moving arrows',\n              description: \"schizophreniac arrows moving all around.\\n                add cosinus interpolation on arrow's turns\",\n              sample_url: './moving_arrows.html',\n              img_path: './thumbnails/moving_arrows.png',\n              status: 'almost_ready'\n            }),\n            _react2.default.createElement(_sample_preview2.default, {\n              name: 'planets focus',\n              description: \"star system emulation, where we\\n                dynamically change focus on random stellar body,\\n                i.e. move it to the center of coordinates and make all others spin around it\",\n              sample_url: './planets_focus.html',\n              img_path: './thumbnails/planets_focus.jpg',\n              status: 'in_progress'\n            }),\n            _react2.default.createElement(_sample_preview2.default, {\n              name: 'basic random tableau',\n              description: \"random start configuration, pixels change their colors with edgy jump from white to black\",\n              sample_url: './basic_tableau.html',\n              img_path: './thumbnails/basic_tableau.jpg',\n              status: 'ready'\n            }),\n            _react2.default.createElement(_sample_preview2.default, {\n              name: 'smooth random tableau',\n              description: \"random start configuration, pixels change their colors smoothly -- black to white and backward\",\n              sample_url: './smooth_tableau.html',\n              img_path: './thumbnails/smooth_tableau.jpg',\n              status: 'ready'\n            }),\n            _react2.default.createElement(_sample_preview2.default, {\n              name: 'rule 30',\n              description: \"cellular automaton evolution of rule 30 introduced by stephen wolfram in 1983\",\n              sample_url: './rule_30.html',\n              img_path: './thumbnails/rule_30.jpg',\n              status: 'ready'\n            }),\n            _react2.default.createElement(_sample_preview2.default, {\n              name: 'orbits',\n              description: \"experiment with 3d polar functions\",\n              sample_url: './orbits.html',\n              img_path: './thumbnails/orbits.jpg',\n              status: 'in_progress'\n            }),\n            _react2.default.createElement(_sample_preview2.default, {\n              name: 'luna',\n              description: \"its like moon -- planet with craters on surface\",\n              sample_url: './luna.html',\n              img_path: './thumbnails/luna.jpg',\n              status: 'in_progress'\n            })\n          )\n        )\n      );\n    }\n  }]);\n\n  return SamplesCollecton;\n}(_react2.default.Component);\n\nexports.default = SamplesCollecton;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _color = require(\"common/color\");\n\nvar _color2 = _interopRequireDefault(_color);\n\nvar _basic_drawer = require(\"experimental/basic_drawer\");\n\nvar _basic_drawer2 = _interopRequireDefault(_basic_drawer);\n\nvar _pixi = require(\"pixi.js\");\n\nvar PIXI = _interopRequireWildcard(_pixi);\n\nvar _planet = require(\"./planet\");\n\nvar _planet2 = _interopRequireDefault(_planet);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Luna = function (_Planet) {\n  _inherits(Luna, _Planet);\n\n  function Luna() {\n    _classCallCheck(this, Luna);\n\n    return _possibleConstructorReturn(this, (Luna.__proto__ || Object.getPrototypeOf(Luna)).apply(this, arguments));\n  }\n\n  _createClass(Luna, [{\n    key: \"sphere_map\",\n    value: function sphere_map() {\n      var _this2 = this;\n\n      var map = [];\n      var count_craters = 50;\n      var i = 0;\n      var craters_data = [];\n\n      var _loop = function _loop() {\n        if (++i > 1000) {\n          throw \"too many cycles\";\n        }\n        // rotation has no meaning in this case\n        var precession = _util2.default.rand_float(0, 2 * Math.PI);\n        var nutation = _util2.default.rand_float(0, 2 * Math.PI);\n        var crater_diameter = _util2.default.rand_float(_util2.default.radians(1), _util2.default.radians(15));\n        var planet_radius = _this2.radius;\n        var crossing = craters_data.some(function (c) {\n          var distance = crater_diameter + c.crater_diameter + _util2.default.radians(2);\n          return _this2.sphere_angles_distance({ precession: precession, nutation: nutation }, c) < distance;\n        });\n        if (crossing) {\n          return \"continue\";\n        }\n        craters_data.push({ precession: precession, nutation: nutation, crater_diameter: crater_diameter });\n\n        var crater = _this2.crater(planet_radius, crater_diameter, precession, nutation);\n        map = map.concat(crater);\n        count_craters--;\n      };\n\n      while (count_craters) {\n        var _ret = _loop();\n\n        if (_ret === \"continue\") continue;\n      }\n      return map;\n    }\n  }, {\n    key: \"crater\",\n    value: function crater(planet_radius, crater_diameter, precession, nutation) {\n      var data = [];\n      var angle_step = 2 * Math.PI / (1500 * crater_diameter);\n      for (var a = 0; a <= 2 * Math.PI; a += angle_step) {\n        var coords = this.calc_single_point(planet_radius, a, crater_diameter, 0, precession, nutation);\n        var theta = Math.atan2(Math.sqrt(coords.x * coords.x + coords.y * coords.y), coords.z);\n        var phi = Math.atan2(coords.y, coords.x);\n\n        data.push({ phi: phi, theta: theta });\n      }\n      return data;\n    }\n  }, {\n    key: \"sphere_angles_distance\",\n    value: function sphere_angles_distance(a, b) {\n      var c1 = this.calc_single_point(1, 0, 0, 0, a.precession, a.nutation);\n      var c2 = this.calc_single_point(1, 0, 0, 0, b.precession, b.nutation);\n      var scalar = c1.x * c2.x + c1.y * c2.y + c1.z * c2.z;\n      var module = Math.sqrt(c1.x * c1.x + c1.y * c1.y + c1.z * c1.z) * Math.sqrt(c2.x * c2.x + c2.y * c2.y + c2.z * c2.z);\n      return Math.acos(scalar / module);\n    }\n  }]);\n\n  return Luna;\n}(_planet2.default);\n\nexports.default = Luna;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _color = require(\"common/color\");\n\nvar _color2 = _interopRequireDefault(_color);\n\nvar _basic_drawer = require(\"experimental/basic_drawer\");\n\nvar _basic_drawer2 = _interopRequireDefault(_basic_drawer);\n\nvar _pixi = require(\"pixi.js\");\n\nvar PIXI = _interopRequireWildcard(_pixi);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n/**\n *  TODO:\n *    - add debug info of angle_inc, acceleration, speed\n *    - zooming with speed change? tried, looks bad\n *    - fix graphics redraw leaps!!!\n */\nvar MovingArrows = function (_BasicDrawer) {\n  _inherits(MovingArrows, _BasicDrawer);\n\n  function MovingArrows() {\n    _classCallCheck(this, MovingArrows);\n\n    return _possibleConstructorReturn(this, (MovingArrows.__proto__ || Object.getPrototypeOf(MovingArrows)).call(this, 'square'));\n  }\n\n  _createClass(MovingArrows, [{\n    key: \"init_graphics\",\n    value: function init_graphics() {\n      var _this2 = this;\n\n      this.size_coef = 7;\n      this.step = this.size / this.size_coef;\n      this.matrix_size = 2 * this.size;\n      this.arrows = [];\n      this.change_angle_base_threshold = 100;\n      this.change_angle_tick = this.change_angle_base_threshold;\n      this.angle = 2 * Math.PI * Math.random();\n      this.angle_inc = 0;\n      this.angle_inc_max = 2 * Math.PI / 360;\n      this.acceleration = 0;\n      this.max_speed = 1.2;\n      this.min_speed = 0.6;\n      this.speed = (this.max_speed - this.min_speed) / 2;\n      this.color = [255, 255, 255];\n      this.matrix_container = new PIXI.Container();\n      this.matrix_container.x = -this.step;\n      this.matrix_container.y = -this.step;\n      this.base_container.addChild(this.matrix_container);\n\n      for (var y = -2 * this.step; y < this.matrix_size; y += this.step) {\n        for (var x = -2 * this.step; x < this.matrix_size; x += this.step) {\n          // git very bad quality on big scales, so we have to set it small and big font size\n          var size = this.step * 9;\n          var arrow = new PIXI.Text('', { fontFamily: 'Arial', fontSize: size, fill: _color2.default.to_pixi(this.color) });\n          arrow.scale = { x: 0.1, y: 0.1 };\n          arrow.x = x;\n          arrow.y = y;\n          arrow.rotation = this.angle;\n          this.arrows.push(arrow);\n        }\n      }\n      this.arrows.forEach(function (arrow) {\n        return _this2.matrix_container.addChild(arrow);\n      });\n    }\n  }, {\n    key: \"redraw\",\n    value: function redraw() {\n      var _this3 = this;\n\n      if (--this.change_angle_tick <= 0) {\n        this.change_angle_tick = this.change_angle_base_threshold * (3 * Math.random() + .2) | 0;\n        var rand_angle = this.linear_interpolation(-this.angle_inc_max, this.angle_inc_max, Math.random());\n        // turn and go straight\n        this.angle_inc = this.angle_inc ? 0 : rand_angle;\n      }\n      this.angle += this.angle_inc;\n      // TODO its very bad that speed depends totally on angle\n      var acceleration = this.angle_inc_max / 2 - Math.abs(this.angle_inc);\n      var new_speed = this.speed + acceleration;\n      new_speed *= this.tick_delta;\n      this.speed = Math.max(this.min_speed, Math.min(new_speed, this.max_speed));\n\n      var radius = this.speed;\n      var angle = this.angle;\n      var diff = _util2.default.from_polar_coords(angle, radius);\n      this.arrows.forEach(function (arrow) {\n        // TODO seems too complicated. is there better way?\n        arrow.x = (arrow.x + diff.x) % _this3.matrix_size + (arrow.x < 0 ? _this3.matrix_size : 0);\n        arrow.y = (arrow.y + diff.y) % _this3.matrix_size + (arrow.y < 0 ? _this3.matrix_size : 0);\n        arrow.rotation = _this3.angle;\n      });\n    }\n\n    // took it from http://freespace.virgin.net/hugo.elias/models/m_perlin.htm\n    // russian https://habrahabr.ru/post/142592/\n\n  }, {\n    key: \"cos_interpolation\",\n    value: function cos_interpolation(min, max, x) {\n      var f = (1 - Math.cos(Math.PI * x)) * .5;\n      return min * (1 - f) + max * f;\n    }\n  }, {\n    key: \"linear_interpolation\",\n    value: function linear_interpolation(min, max, x) {\n      return min * (1 - x) + max * x;\n    }\n  }]);\n\n  return MovingArrows;\n}(_basic_drawer2.default);\n\nexports.default = MovingArrows;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _color = require(\"common/color\");\n\nvar _color2 = _interopRequireDefault(_color);\n\nvar _basic_drawer = require(\"experimental/basic_drawer\");\n\nvar _basic_drawer2 = _interopRequireDefault(_basic_drawer);\n\nvar _pixi = require(\"pixi.js\");\n\nvar PIXI = _interopRequireWildcard(_pixi);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Orbits = function (_BasicDrawer) {\n  _inherits(Orbits, _BasicDrawer);\n\n  function Orbits() {\n    _classCallCheck(this, Orbits);\n\n    return _possibleConstructorReturn(this, (Orbits.__proto__ || Object.getPrototypeOf(Orbits)).call(this, 'circle'));\n  }\n\n  _createClass(Orbits, [{\n    key: \"update_debug_info\",\n    value: function update_debug_info() {\n      return [{ id: 'debug_info_precession', text: 'precession', value: this.figures ? this.figures[0].precession_coef : '' }, { id: 'debug_info_nutation', text: 'nutation', value: this.figures ? this.figures[0].nutation_coef : '' }, { id: 'debug_info_additional', text: 'angle this.acceleration', value: this.acceleration }];\n    }\n  }, {\n    key: \"init_graphics\",\n    value: function init_graphics() {\n      var _this2 = this;\n\n      this.count_figures = 1;\n      this.figures = [].concat(_toConsumableArray(Array(this.count_figures).keys())).map(function (i) {\n        var graphics = new PIXI.Graphics();\n        _this2.base_container.addChild(graphics);\n        return {\n          id: i,\n          graphics: graphics,\n          radius: 0.9 * 0.5 * _this2.size,\n          //rotation_coef: .0025,\n          precession_coef: .0025 * _util2.default.rand_float(-3, 3),\n          nutation_coef: .0025 * _util2.default.rand_float(1, 3)\n        };\n      });\n    }\n  }, {\n    key: \"redraw\",\n    value: function redraw() {\n      var _this3 = this;\n\n      this.figures.forEach(function (figure) {\n        return _this3.draw_full_circle(figure);\n      });\n    }\n  }, {\n    key: \"calc_single_point\",\n    value: function calc_single_point(radius, angle, precession, nutation) {\n      var x = radius * Math.cos(angle) * Math.sin(nutation);\n      var y = radius * Math.sin(angle);\n      var sp = Math.sin(precession);\n      var cp = Math.cos(precession);\n      var nx = x * cp - y * sp;\n      var ny = x * sp + y * cp;\n      return { x: nx, y: ny };\n    }\n  }, {\n    key: \"draw_full_circle\",\n    value: function draw_full_circle(figure) {\n      figure.graphics.clear();\n      var count_dots = 2 * 36;\n      this.acceleration = 5 * Math.cos(.005 * this.tick_time);\n      for (var angle = 0; angle <= 2 * Math.PI; angle += 2 * Math.PI / count_dots) {\n        var coords = this.calc_single_point(figure.radius,\n        //angle + (figure.rotation_coef * this.tick_time) + this.acceleration,\n        // i dont understand why its really this.acceleration and where is the speed?\n        angle + this.acceleration, figure.precession_coef * this.tick_time, figure.nutation_coef * this.tick_time + 0.5 * this.acceleration);\n        figure.graphics.beginFill(_color2.default.to_pixi([255, 255, 255]));\n        //figure.graphics.drawRect(coords.x, coords.y, .5, .5);\n        figure.graphics.drawCircle(coords.x, coords.y, 1);\n        figure.graphics.endFill();\n      }\n    }\n  }]);\n\n  return Orbits;\n}(_basic_drawer2.default);\n\nexports.default = Orbits;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _color = require(\"common/color\");\n\nvar _color2 = _interopRequireDefault(_color);\n\nvar _basic_drawer = require(\"experimental/basic_drawer\");\n\nvar _basic_drawer2 = _interopRequireDefault(_basic_drawer);\n\nvar _pixi = require(\"pixi.js\");\n\nvar PIXI = _interopRequireWildcard(_pixi);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Planet = function (_BasicDrawer) {\n  _inherits(Planet, _BasicDrawer);\n\n  function Planet() {\n    _classCallCheck(this, Planet);\n\n    return _possibleConstructorReturn(this, (Planet.__proto__ || Object.getPrototypeOf(Planet)).call(this, 'circle'));\n  }\n\n  _createClass(Planet, [{\n    key: \"update_debug_info\",\n    value: function update_debug_info() {\n      return [{ id: 'debug_info_precession', text: 'precession', value: _util2.default.degrees(this.precession) | 0 }, { id: 'debug_info_nutation', text: 'nutation', value: _util2.default.degrees(this.nutation) | 0 }, { id: 'debug_info_rotation', text: 'rotation', value: _util2.default.degrees(this.rotation) | 0 }, { id: 'debug_info_count_points', text: 'count points', value: this.points ? this.points.length : 0 }];\n    }\n  }, {\n    key: \"init_graphics\",\n    value: function init_graphics() {\n      this.planet = new PIXI.Container();\n      this.base_container.addChild(this.planet);\n\n      this.radius = 0.9 * 0.5 * this.size;\n      this.rotation = null;\n      this.precession = null;\n      this.nutation = null;\n      this.points = this.init_graphics_from_sphere_map(this.sphere_map());\n      this.map_transparency_alpha = 0;\n      this.draw_contour = true;\n\n      if (this.draw_contour) {\n        var contour = new PIXI.Graphics();\n        contour.lineStyle(1, _color2.default.to_pixi([255, 255, 255]));\n        contour.drawCircle(0, 0, this.radius);\n        this.base_container.addChild(contour);\n      }\n    }\n  }, {\n    key: \"redraw\",\n    value: function redraw() {\n      var _this2 = this;\n\n      this.change_angles(this.ticks);\n      this.points.forEach(function (point) {\n        var coords = _this2.calc_single_point(_this2.radius, point.phi, point.theta, _this2.rotation, _this2.precession, _this2.nutation);\n        point.graphics.alpha = coords.z < 0 ? _this2.map_transparency_alpha : 1;\n        point.graphics.x = coords.x;\n        point.graphics.y = coords.y;\n      });\n    }\n  }, {\n    key: \"calc_single_point\",\n    value: function calc_single_point(radius, phi, theta, rotation, precession, nutation) {\n      var x = radius * Math.cos(phi) * Math.sin(theta),\n          y = radius * Math.sin(phi) * Math.sin(theta),\n          z = radius * Math.cos(theta),\n          sin_r = Math.sin(rotation),\n          cos_r = Math.cos(rotation),\n          sin_p = Math.sin(precession),\n          cos_p = Math.cos(precession),\n          sin_n = Math.sin(nutation),\n          cos_n = Math.cos(nutation),\n          cos_n_sin_r = cos_n * sin_r,\n          cos_n_cos_r = cos_n * cos_r,\n          x2 = x * (cos_p * cos_r - sin_p * cos_n_sin_r) + y * (-cos_p * sin_r - sin_p * cos_n_cos_r) + z * (sin_p * sin_n),\n          y2 = x * (sin_p * cos_r + cos_p * cos_n_sin_r) + y * (-sin_p * sin_r + cos_p * cos_n_cos_r) + z * (-cos_p * sin_n),\n          z2 = x * (sin_n * sin_r) + y * (sin_n * cos_r) + z * cos_n;\n      return { x: x2, y: y2, z: z2 };\n    }\n  }, {\n    key: \"change_angles\",\n    value: function change_angles(ticks) {\n      this.rotation = _util2.default.radians(0) + ticks * (2 * Math.PI / 360);\n      this.precession = _util2.default.radians(22.5) + _util2.default.radians(22.5) * Math.sin(ticks / 360);\n      this.nutation = _util2.default.radians(60) + 0 * ticks * (2 * Math.PI / 360);\n    }\n  }, {\n    key: \"sphere_map\",\n    value: function sphere_map() {\n      return [].concat(_toConsumableArray(Array(500).keys())).map(function (i) {\n        return {\n          phi: _util2.default.rand_float(0, 2 * Math.PI),\n          theta: _util2.default.rand_float(0, 2 * Math.PI)\n        };\n      });\n    }\n  }, {\n    key: \"init_graphics_from_sphere_map\",\n    value: function init_graphics_from_sphere_map(sphere_map) {\n      var _this3 = this;\n\n      return sphere_map.map(function (e) {\n        e.graphics = new PIXI.Graphics();\n        e.graphics.beginFill(_color2.default.to_pixi([255, 255, 255]), 1);\n        e.graphics.drawRect(0, 0, .5, .5);\n        e.graphics.endFill();\n        _this3.planet.addChild(e.graphics);\n        return e;\n      });\n    }\n  }]);\n\n  return Planet;\n}(_basic_drawer2.default);\n\nexports.default = Planet;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _color = require(\"common/color\");\n\nvar _color2 = _interopRequireDefault(_color);\n\nvar _basic_drawer = require(\"experimental/basic_drawer\");\n\nvar _basic_drawer2 = _interopRequireDefault(_basic_drawer);\n\nvar _pixi = require(\"pixi.js\");\n\nvar PIXI = _interopRequireWildcard(_pixi);\n\nvar _d = require(\"d3\");\n\nvar d3 = _interopRequireWildcard(_d);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n/**\n *\n */\nvar PlanetsFocus = function (_BasicDrawer) {\n  _inherits(PlanetsFocus, _BasicDrawer);\n\n  function PlanetsFocus() {\n    _classCallCheck(this, PlanetsFocus);\n\n    return _possibleConstructorReturn(this, (PlanetsFocus.__proto__ || Object.getPrototypeOf(PlanetsFocus)).call(this, 'circle'));\n  }\n\n  _createClass(PlanetsFocus, [{\n    key: \"init_graphics\",\n    value: function init_graphics() {\n      this.matrix = new PIXI.Container();\n      this.base_container.addChild(this.matrix);\n      this.bodies = [];\n      this.init_bodies();\n      this.forced_focus = false;\n      this.focused_body = this.bodies[0];\n      this.focus_change_threshold = 300;\n      this.focus_change_tick = this.focus_change_threshold;\n      this.update_matrix_by_focus();\n    }\n  }, {\n    key: \"redraw\",\n    value: function redraw() {\n      var _this2 = this;\n\n      this.bodies.forEach(function (body) {\n        body.orbital_angle += _this2.tick_delta * body.orbital_speed;\n        body.angle += _this2.tick_delta * (body.orbital_speed + body.rotation_speed);\n        _this2.set_graphics_transform_by_stellar_coords(body);\n      });\n      if (--this.focus_change_tick <= 0) {\n        this.focus_change_tick = this.focus_change_threshold;\n        if (!this.forced_focus) {\n          var cur_index = this.bodies.indexOf(this.focused_body);\n          this.focused_body = this.bodies[cur_index == this.bodies.length - 1 ? 0 : cur_index + 1];\n          console.log('now focus on', this.focused_body.name);\n        }\n      }\n      this.update_matrix_by_focus();\n      d3.select('#debug_info_focus_on').html(this.focused_body.name);\n    }\n  }, {\n    key: \"update_matrix_by_focus\",\n    value: function update_matrix_by_focus() {\n      // TODO do it second time on each frame, bad\n      var coords = this.calc_coords_recursively(this.focused_body);\n      this.matrix.position.x = -coords.x;\n      this.matrix.position.y = -coords.y;\n    }\n  }, {\n    key: \"calc_coords_recursively\",\n    value: function calc_coords_recursively(body) {\n      var acc = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : { x: 0, y: 0 };\n\n      var coords = _util2.default.from_polar_coords(body.orbital_angle, body.orbital_radius);\n      acc.x += coords.x;\n      acc.y += coords.y;\n      if (body.parent) {\n        return this.calc_coords_recursively(body.parent, acc);\n      }\n      return acc;\n    }\n  }, {\n    key: \"init_bodies\",\n    value: function init_bodies() {\n      // name, parent, orbital_radius, radius, orbital_speed, rotation_speed, [orbital_angle], [angle]\n      this.star = this.init_body('star', null, 0, 10, 0, .5);\n      this.planet1 = this.init_body('planet1', this.star, 20, 3, 1, 0);\n      this.moon1 = this.init_body('moon1', this.planet1, 6, 1, 2, 2);\n      this.planet2 = this.init_body('planet2', this.star, 40, 5, 2, 3);\n      this.moon21 = this.init_body('moon21', this.planet2, 8, 2, 3, .1);\n      this.moon22 = this.init_body('moon22', this.planet2, 12, 1, 4, 1);\n    }\n  }, {\n    key: \"init_body\",\n    value: function init_body(name, parent, orbital_radius, radius, orbital_speed, rotation_speed) {\n      var body = new StellarBody(name, parent, orbital_radius, radius, orbital_speed, rotation_speed);\n      this.init_body_graphics(body, parent);\n      var parent_graphics = parent ? parent.base_container : this.matrix;\n      parent_graphics.addChild(body.base_container);\n      this.bodies.push(body);\n      return body;\n    }\n  }, {\n    key: \"init_body_graphics\",\n    value: function init_body_graphics(body, parent) {\n      // thats because base_container do not rotate with planet rotation, otherwise\n      // all moons rotate with planet's self rotations\n      body.base_container = new PIXI.Graphics();\n      body.graphics = new PIXI.Graphics();\n      body.base_container.addChild(body.graphics);\n      this.set_graphics_transform_by_stellar_coords(body);\n      body.graphics.lineStyle(body.radius / 10, _color2.default.to_pixi([255, 255, 255]));\n      body.graphics.drawCircle(0, 0, body.radius);\n      body.graphics.closePath();\n      [1, 2, 3].forEach(function (i) {\n        var coords = _util2.default.from_polar_coords(i * 2 * Math.PI / 3, body.radius / 2);\n        body.graphics.drawCircle(coords.x, coords.y, body.radius / 4);\n        body.graphics.closePath();\n      });\n    }\n  }, {\n    key: \"set_graphics_transform_by_stellar_coords\",\n    value: function set_graphics_transform_by_stellar_coords(body) {\n      var coords = _util2.default.from_polar_coords(body.orbital_angle, body.orbital_radius);\n      // thats not a mistake, see comment below\n      body.base_container.x = coords.x;\n      body.base_container.y = coords.y;\n      body.graphics.rotation = body.angle;\n    }\n  }]);\n\n  return PlanetsFocus;\n}(_basic_drawer2.default);\n\nexports.default = PlanetsFocus;\n\nvar StellarBody = function StellarBody(name, parent, orbital_radius, radius, orbital_speed, rotation_speed) {\n  var orbital_angle = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : false;\n  var angle = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : false;\n\n  _classCallCheck(this, StellarBody);\n\n  var radius_factor = 1.5; // DEBUG!!!\n  this.name = name;\n  this.parent = parent;\n  this.orbital_radius = radius_factor * orbital_radius;\n  this.radius = radius_factor * radius;\n  this.orbital_speed = _util2.default.radians(orbital_speed);\n  this.rotation_speed = _util2.default.radians(rotation_speed);\n  this.orbital_angle = orbital_angle ? orbital_angle : 2 * Math.PI * Math.random();\n  this.angle = angle ? angle : 2 * Math.PI * Math.random();\n};\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _tableau = require(\"experimental/tableau\");\n\nvar _tableau2 = _interopRequireDefault(_tableau);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n/**\n * https://en.wikipedia.org/wiki/Rule_30\n */\nvar Rule30 = function (_Tableau) {\n  _inherits(Rule30, _Tableau);\n\n  function Rule30() {\n    _classCallCheck(this, Rule30);\n\n    return _possibleConstructorReturn(this, (Rule30.__proto__ || Object.getPrototypeOf(Rule30)).apply(this, arguments));\n  }\n\n  _createClass(Rule30, [{\n    key: \"init_element_state\",\n    value: function init_element_state(element) {\n      //element.color = (element.y == this.y_size - 1) && (element.x == this.x_size / 2 | 0) ? 1 : 0;\n      element.color = 0;\n    }\n  }, {\n    key: \"mutate_state\",\n    value: function mutate_state() {\n      // throttle to lower speed\n      if (this.ticks % 3 == 1) {\n        _get(Rule30.prototype.__proto__ || Object.getPrototypeOf(Rule30.prototype), \"mutate_state\", this).call(this);\n      }\n    }\n\n    // this func suppose to change new_color prop, not color!\n\n  }, {\n    key: \"mutate_element_state\",\n    value: function mutate_element_state(element) {\n      var color = 0;\n      if (element.y == this.y_size - 1) {\n        var l = this.get_neighbour_color(element.x - 1, element.y);\n        var r = this.get_neighbour_color(element.x + 1, element.y);\n        var s = element.color;\n        color = this.element_state_rule(l, r, s);\n      } else {\n        // just copy lower cell color\n        color = this.data[element.y + 1][element.x].color;\n      }\n      element.new_color = color;\n    }\n\n    /**\n     *  this is the main BAD moment -- we got RANDOM color for cells out of border\n     *  thats NOT CORRECT and so this all is not pure rule 30 evolution, but\n     *  rule 30 with random initial state and random border conditions\n     */\n\n  }, {\n    key: \"get_neighbour_color\",\n    value: function get_neighbour_color(x, y) {\n      return this.data[y] && this.data[y][x] ? this.data[y][x].color : _util2.default.rand(0, 1);\n    }\n\n    // thats rule 30 itself\n\n  }, {\n    key: \"element_state_rule\",\n    value: function element_state_rule(l, r, s) {\n      // its a marasmus, but\n      switch ('' + l + r + s) {\n        case '111':\n        case '110':\n        case '101':\n          return 0;\n        case '100':\n        case '011':\n        case '010':\n        case '001':\n          return 1;\n        case '000':\n          return 0;\n        default:\n          throw { msg: \"unknown pattern\", pattern: [l, r, s] };\n      }\n    }\n  }]);\n\n  return Rule30;\n}(_tableau2.default);\n\nexports.default = Rule30;\n","'use strict';\n\nvar _reactDom = require('react-dom');\n\nvar _reactDom2 = _interopRequireDefault(_reactDom);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _samples_collection = require('experimental/components/samples_collection');\n\nvar _samples_collection2 = _interopRequireDefault(_samples_collection);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\ndocument.addEventListener('DOMContentLoaded', function () {\n  _reactDom2.default.render(_react2.default.createElement(_samples_collection2.default, null), document.querySelector('#main'));\n});\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _color = require(\"common/color\");\n\nvar _color2 = _interopRequireDefault(_color);\n\nvar _basic_drawer = require(\"experimental/basic_drawer\");\n\nvar _basic_drawer2 = _interopRequireDefault(_basic_drawer);\n\nvar _pixi = require(\"pixi.js\");\n\nvar PIXI = _interopRequireWildcard(_pixi);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n/**\n *\n */\nvar Tableau = function (_BasicDrawer) {\n  _inherits(Tableau, _BasicDrawer);\n\n  function Tableau() {\n    _classCallCheck(this, Tableau);\n\n    return _possibleConstructorReturn(this, (Tableau.__proto__ || Object.getPrototypeOf(Tableau)).call(this, 'square'));\n  }\n\n  _createClass(Tableau, [{\n    key: \"init_graphics\",\n    value: function init_graphics() {\n      this.color_change_per_tick = 8;\n      this.x_size = 100;\n      this.y_size = 100;\n      this.data = [];\n      var square_size = Math.min(this.size / this.x_size, this.size / this.y_size);\n      for (var y = 0; y < this.y_size; y++) {\n        this.data[y] = [];\n        for (var x = 0; x < this.x_size; x++) {\n          var graphics = new PIXI.Graphics();\n          graphics.beginFill(_color2.default.to_pixi([255, 255, 255]));\n          graphics.drawRect(_util2.default.normalize_value(x, this.x_size, this.size), _util2.default.normalize_value(y, this.y_size, this.size), square_size, square_size);\n          graphics.endFill();\n          this.base_container.addChild(graphics);\n          this.data[y][x] = {\n            x: x,\n            y: y,\n            color: 0,\n            new_color: 0,\n            graphics: graphics\n          };\n        }\n      }\n      this.init_state();\n      this.update_cells();\n    }\n  }, {\n    key: \"redraw\",\n    value: function redraw() {\n      this.mutate_state();\n      this.update_cells();\n    }\n  }, {\n    key: \"update_cells\",\n    value: function update_cells() {\n      this.for_all_elements(function (element) {\n        return element.graphics.alpha = element.color;\n      });\n    }\n  }, {\n    key: \"for_all_elements\",\n    value: function for_all_elements(func) {\n      this.data.forEach(function (line) {\n        line.forEach(function (element) {\n          func(element);\n        });\n      });\n    }\n  }, {\n    key: \"init_state\",\n    value: function init_state() {\n      var _this2 = this;\n\n      this.for_all_elements(function (element) {\n        return _this2.init_element_state(element);\n      });\n    }\n  }, {\n    key: \"init_element_state\",\n    value: function init_element_state(element) {\n      element.color = Math.random();\n    }\n  }, {\n    key: \"mutate_state\",\n    value: function mutate_state() {\n      var _this3 = this;\n\n      this.for_all_elements(function (element) {\n        return _this3.mutate_element_state(element);\n      });\n      this.for_all_elements(function (element) {\n        return element.color = element.new_color;\n      });\n    }\n\n    // this func suppose to change new_color prop, not color!\n\n  }, {\n    key: \"mutate_element_state\",\n    value: function mutate_element_state(element) {\n      element.new_color = (element.color + this.color_change_per_tick / 256) % 1;\n    }\n  }]);\n\n  return Tableau;\n}(_basic_drawer2.default);\n\nexports.default = Tableau;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _color = require(\"common/color\");\n\nvar _color2 = _interopRequireDefault(_color);\n\nvar _tableau = require(\"experimental/tableau\");\n\nvar _tableau2 = _interopRequireDefault(_tableau);\n\nvar _pixi = require(\"pixi.js\");\n\nvar PIXI = _interopRequireWildcard(_pixi);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n/**\n *\n */\nvar TableauSmooth = function (_Tableau) {\n  _inherits(TableauSmooth, _Tableau);\n\n  function TableauSmooth() {\n    _classCallCheck(this, TableauSmooth);\n\n    return _possibleConstructorReturn(this, (TableauSmooth.__proto__ || Object.getPrototypeOf(TableauSmooth)).apply(this, arguments));\n  }\n\n  _createClass(TableauSmooth, [{\n    key: \"init_element_state\",\n    value: function init_element_state(element) {\n      element.color = Math.random();\n      element.sign = 1;\n    }\n  }, {\n    key: \"mutate_element_state\",\n    value: function mutate_element_state(element) {\n      if (element.color <= 0) {\n        element.sign = 1;\n      } else if (element.color >= 1) {\n        element.sign = -1;\n      }\n      element.new_color = element.color + element.sign * (this.color_change_per_tick / 256);\n      // they can be slightly less or greater this because of float calc errors or maybe some my error\n      element.new_color = Math.max(0, element.new_color);\n      element.new_color = Math.min(1, element.new_color);\n    }\n  }]);\n\n  return TableauSmooth;\n}(_tableau2.default);\n\nexports.default = TableauSmooth;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _color = require(\"common/color\");\n\nvar _color2 = _interopRequireDefault(_color);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n////////////////////////////////////////////////\n// WARNING!!! doesnt work, rewite to BasicDrawer\n////////////////////////////////////////////////\nvar BlurGenerator = function () {\n  function BlurGenerator() {\n    _classCallCheck(this, BlurGenerator);\n\n    this.map = game.map_drawer.map;\n    this.exp_container = new PIXI.Container();\n    this.map.stage.addChild(this.exp_container);\n  }\n\n  _createClass(BlurGenerator, [{\n    key: \"exp_dots\",\n    value: function exp_dots() {\n      var _this = this;\n\n      var points_count_coef = .0050;\n      var points_count = points_count_coef * this.map.view.width * this.map.view.height;\n      var radius_coef = 0.03;\n      var radius = radius_coef * Math.min(this.map.view.width, this.map.view.height);\n      var count_near_threshold = points_count * radius_coef;\n      var steps_count = 10;\n\n      console.log('points_count', points_count, 'radius', radius, 'count_near_threshold', count_near_threshold);\n      var points = [];\n      while (points_count--) {\n        points.push({ x: _util2.default.rand(0, this.map.view.width), y: _util2.default.rand(0, this.map.view.height) });\n      }\n      var basic_color = [60, 30, 0];\n      while (--steps_count) {\n        basic_color = _color2.default.brighter(basic_color, 20);\n        this.exp_dots_step(radius, count_near_threshold / steps_count | 0, points, basic_color);\n      }\n      points.forEach(function (point) {\n        return _this.exp_dots_draw_circle(point.x, point.y, 2, [200, 100, 0]);\n      });\n    }\n  }, {\n    key: \"exp_dots_step\",\n    value: function exp_dots_step(radius, count_near_threshold, points, color) {\n      var _this2 = this;\n\n      console.log('exp_dots_step radius', radius, 'threshold', count_near_threshold);\n      var nears_sum = 10;\n      points.forEach(function (point) {\n        var count_near = _this2.exp_dots_count_near(point, radius, points);\n        nears_sum += count_near;\n        if (count_near >= count_near_threshold) {\n          _this2.exp_dots_draw_circle(point.x, point.y, radius, color);\n        }\n      });\n      console.log('near mid', nears_sum / points.length);\n    }\n  }, {\n    key: \"exp_dots_draw_circle\",\n    value: function exp_dots_draw_circle(x, y, radius, color) {\n      var graphics = new PIXI.Graphics();\n      graphics.beginFill(_color2.default.to_pixi(color));\n      graphics.drawCircle(x, y, radius);\n      graphics.closePath();\n      graphics.endFill();\n      this.exp_container.addChild(graphics);\n    }\n  }, {\n    key: \"exp_dots_count_near\",\n    value: function exp_dots_count_near(from, radius, points) {\n      var filtered = points.filter(function (point) {\n        return _util2.default.distance(from, point) <= radius;\n      });\n      return filtered.length - 1;\n    }\n  }]);\n\n  return BlurGenerator;\n}();\n\nexports.default = BlurGenerator;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _color = require(\"common/color\");\n\nvar _color2 = _interopRequireDefault(_color);\n\nvar _d = require(\"d3\");\n\nvar d3 = _interopRequireWildcard(_d);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n////////////////////////////////////////////////\n// WARNING!!! doesnt work, rewite to BasicDrawer\n////////////////////////////////////////////////\nvar DensityMap = function () {\n  function DensityMap() {\n    _classCallCheck(this, DensityMap);\n\n    this.reject_limit = 500;\n    this.average_distance_threshold = 0.05;\n    this.zero_distance_sum = 0;\n  }\n\n  _createClass(DensityMap, [{\n    key: \"random_point\",\n    value: function random_point() {\n      var initial = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n      return { x: 2 * Math.random() - 1, y: 2 * Math.random() - 1, initial: initial };\n    }\n  }, {\n    key: \"generate\",\n    value: function generate(count) {\n      var count_basic = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 10;\n\n      var reject_counter = this.reject_limit;\n      var total_rejects = 0;\n      this.points = [];\n      // basic points\n      while (count_basic) {\n        var point = this.random_point(true);\n        if (this.check_in_circle(point)) {\n          this.points.push(point);\n          count_basic--;\n        }\n      }\n      // regular points\n      while (this.points.length < count) {\n        var _point = this.random_point(false);\n        if (!this.check_in_circle(_point)) {\n          continue; // do not decrement reject_counter\n        }\n        if (!this.check_average_distance(_point)) {\n          reject_counter--;\n          total_rejects++;\n        } else {\n          reject_counter = this.reject_limit;\n          this.points.push(_point);\n          this.zero_distance_sum += _util2.default.distance(_point, { x: 0, y: 0 });\n        }\n        if (!reject_counter) {\n          console.log(\"DensityMap.generate() reject limit \" + this.reject_limit + \" reached, bailing out\");\n          break;\n        }\n      }\n      console.log('done, total_rejects: ', total_rejects);\n      return true;\n    }\n  }, {\n    key: \"check_in_circle\",\n    value: function check_in_circle(point) {\n      return _util2.default.distance(point, { x: 0, y: 0 }) <= 1;\n    }\n  }, {\n    key: \"calc_distance_sum\",\n    value: function calc_distance_sum(point) {\n      return this.points.reduce(function (acc, e) {\n        return acc + _util2.default.distance(point, e);\n      }, 0);\n    }\n  }, {\n    key: \"check_average_distance\",\n    value: function check_average_distance(point) {\n      var value = _util2.default.find_min_and_max(this.points, function (p) {\n        return _util2.default.distance(p, point);\n      }).min;\n      //console.log('value', value);\n      // its like some little chanse for far points\n      var rand = value * Math.pow(Math.random(), 100);\n      return value < this.average_distance_threshold + rand;\n    }\n  }, {\n    key: \"draw\",\n    value: function draw(scale) {\n      var func = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.draw_naive.bind(this);\n\n      var graphics = new PIXI.Graphics();\n      func(scale, graphics);\n      return graphics;\n    }\n  }, {\n    key: \"draw_naive\",\n    value: function draw_naive(scale, graphics) {\n      var radius = .01;\n      this.points.forEach(function (point) {\n        //let color = point.initial ? [125, 255, 0] : [point.channel, 0, 0];\n        var color = point.initial ? [125, 255, 0] : [125, 0, 0];\n        graphics.beginFill(_color2.default.to_pixi(color));\n        graphics.drawCircle(scale * point.x, scale * point.y, scale * radius);\n        graphics.closePath();\n        graphics.endFill();\n      });\n    }\n  }, {\n    key: \"draw_density_grid\",\n    value: function draw_density_grid(scale, graphics) {\n      var _this = this;\n\n      var size = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 100;\n\n      var step = (1 - -1) / size;\n      var grid_points = [];\n\n      var _loop = function _loop(y) {\n        var _loop2 = function _loop2(x) {\n          var grid_point = { x: x, y: y, density: 0 };\n          if (!_this.check_in_circle(grid_point)) {\n            return \"continue\";\n          }\n          grid_point.density = _this.points.filter(function (p) {\n            return p.x >= x && p.y >= y && p.x < x + step && p.y < y + step;\n          }).length;\n          grid_points.push(grid_point);\n        };\n\n        for (var x = -1; x < 1; x += step) {\n          var _ret2 = _loop2(x);\n\n          if (_ret2 === \"continue\") continue;\n        }\n      };\n\n      for (var y = -1; y < 1; y += step) {\n        _loop(y);\n      }\n      var max_density = _util2.default.find_min_and_max(grid_points, function (p) {\n        return p.density;\n      }).max;\n      grid_points.forEach(function (point) {\n        var channel = _util2.default.normalize_value(point.density, max_density, 255, 0, 20);\n        graphics.beginFill(_color2.default.to_pixi([channel, 0, 0]));\n        graphics.drawCircle(scale * point.x, scale * point.y, scale * (step / 2));\n        graphics.closePath();\n        graphics.endFill();\n      });\n    }\n  }]);\n\n  return DensityMap;\n}();\n\nexports.default = DensityMap;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _color = require(\"common/color\");\n\nvar _color2 = _interopRequireDefault(_color);\n\nvar _d = require(\"d3\");\n\nvar d3 = _interopRequireWildcard(_d);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n////////////////////////////////////////////////\n// WARNING!!! doesnt work, rewite to BasicDrawer\n////////////////////////////////////////////////\nvar Links = function () {\n  function Links() {\n    _classCallCheck(this, Links);\n\n    this.points = [];\n    this.size = 10;\n    var angle_divider = 1.5 * this.size | 0;\n    this.angle = Math.PI / angle_divider;\n    console.log(\"Links size: \" + this.size + \", angle divider: \" + angle_divider);\n  }\n\n  _createClass(Links, [{\n    key: \"random_point\",\n    value: function random_point() {\n      return { x: 2 * Math.random() - 1, y: 2 * Math.random() - 1 };\n    }\n  }, {\n    key: \"generate\",\n    value: function generate() {\n      var border_points = [];\n      var grid_points = [];\n      for (var a = 0; a < Math.PI * 2; a += this.angle) {\n        var point = _util2.default.from_polar_coords(a, 1);\n        point.on_border = true;\n        this.points.push(point);\n        border_points.push(point);\n      }\n      var step = this.calc_step();\n      for (var y = -1; y < 1; y += step) {\n        for (var x = -1; x < 1; x += step) {\n          var _point = { x: x, y: y, on_border: false };\n          if (!this.check_in_circle(_point, 1 - step / 2)) {\n            continue;\n          }\n          this.points.push(_point);\n          grid_points.push(_point);\n        }\n      }\n\n      var all_points = grid_points.concat(border_points);\n      grid_points.forEach(function (point) {\n        return point.links = all_points.filter(function (p) {\n          return _util2.default.distance(point, p) <= 1.5 * step;\n        });\n      });\n      var open_list = grid_points.slice();\n      // note that we process only grid points!\n      this.process_links(open_list);\n    }\n  }, {\n    key: \"process_links\",\n    value: function process_links(open_list) {\n      if (!open_list.length) {\n        return;\n      }\n      var element = _util2.default.rand_element(open_list);\n      if (element.links.length < 2) {\n        throw 'bad element, less than 2 links';\n      }\n      var count_border = element.links.filter(function (e) {\n        return e.on_border;\n      }).length;\n      // if only one link to border point left, dont delete it\n      var links_to_process = count_border > 1 ? element.links : element.links.filter(function (e) {\n        return !e.on_border;\n      });\n      var link_to_delete = _util2.default.rand_element(links_to_process);\n      _util2.default.remove_element(link_to_delete, element.links);\n      if (element.links.length <= 2) {\n        _util2.default.remove_element(element, open_list);\n      }\n      // on-border points dont have links\n      if (!link_to_delete.on_border) {\n        if (!_util2.default.remove_element(element, link_to_delete.links)) {\n          console.log('WARNING! linked element had no backlink', link_to_delete, element);\n        }\n        if (link_to_delete.links.length < 2 && !link_to_delete.on_border) {\n          console.log('too bad but some point now has less that 2 links', link_to_delete);\n        }\n        if (link_to_delete.links.length <= 2) {\n          _util2.default.remove_element(link_to_delete, open_list);\n        }\n      }\n      this.process_links(open_list);\n    }\n  }, {\n    key: \"check_in_circle\",\n    value: function check_in_circle(point) {\n      var radius = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n\n      return _util2.default.distance(point, { x: 0, y: 0 }) < radius;\n    }\n  }, {\n    key: \"calc_step\",\n    value: function calc_step() {\n      return (1 - -1) / this.size;\n    }\n  }, {\n    key: \"draw\",\n    value: function draw(scale) {\n      var func = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.draw_naive.bind(this);\n\n      var graphics = new PIXI.Graphics();\n      //graphics.scale = {x: scale, y: scale};\n      func(graphics, scale);\n      return graphics;\n    }\n  }, {\n    key: \"draw_naive\",\n    value: function draw_naive(graphics) {\n      var scale = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n\n      var step = this.calc_step();\n      var radius = step / 6;\n      var color = [30, 0, 0];\n\n      this.points.forEach(function (point) {\n        graphics.beginFill(_color2.default.to_pixi(color));\n        graphics.drawCircle(scale * point.x, scale * point.y, scale * radius);\n        graphics.closePath();\n        graphics.endFill();\n\n        if (point.links) {\n          point.links.forEach(function (link) {\n            graphics.lineStyle(scale * step / 10, _color2.default.to_pixi(color));\n            graphics.moveTo(scale * point.x, scale * point.y);\n            graphics.lineTo(scale * link.x, scale * link.y);\n            graphics.closePath();\n            graphics.lineStyle(0, _color2.default.to_pixi(color));\n          });\n        }\n      });\n    }\n  }]);\n\n  return Links;\n}();\n\nexports.default = Links;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _color = require(\"common/color\");\n\nvar _color2 = _interopRequireDefault(_color);\n\nvar _d = require(\"d3\");\n\nvar d3 = _interopRequireWildcard(_d);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n////////////////////////////////////////////////\n// WARNING!!! doesnt work, rewite to BasicDrawer\n////////////////////////////////////////////////\nvar PointsInCicrle = function () {\n  function PointsInCicrle() {\n    _classCallCheck(this, PointsInCicrle);\n  }\n\n  _createClass(PointsInCicrle, [{\n    key: \"generate\",\n    value: function generate(count, func) {\n      this.points = [];\n      while (count--) {\n        var angle = Math.random() * 2 * Math.PI;\n        var radius = func(Math.random());\n        var coords = _util2.default.from_polar_coords(angle, radius);\n        this.points.push({ angle: angle, radius: radius, x: coords.x, y: coords.y });\n      }\n      this.points;\n      return true;\n    }\n  }, {\n    key: \"draw\",\n    value: function draw(scale) {\n      var color = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [50, 100, 0];\n\n      var graphics = new PIXI.Graphics();\n      var radius = .01;\n\n      this.points.forEach(function (point) {\n        graphics.beginFill(_color2.default.to_pixi(_color2.default.random_near(color, 20)));\n        graphics.drawCircle(scale * point.x, scale * point.y, scale * radius);\n        graphics.closePath();\n        graphics.endFill();\n      });\n\n      return graphics;\n    }\n  }, {\n    key: \"draw_triangles\",\n    value: function draw_triangles(scale) {\n      var color = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [50, 100, 0];\n\n      var voronoi = d3.voronoi().x(function (p) {\n        return p.x;\n      }).y(function (p) {\n        return p.y;\n      });\n      var diagram = voronoi(this.points);\n      var triangles = diagram.triangles();\n\n      var graphics = new PIXI.Graphics();\n      triangles.forEach(function (triangle) {\n        graphics.beginFill(_color2.default.to_pixi(_color2.default.random_near(color, 20)));\n        graphics.drawPolygon(triangle.map(function (point) {\n          return new PIXI.Point(scale * point.x, scale * point.y);\n        }));\n        graphics.closePath();\n        graphics.endFill();\n      });\n      graphics.lineStyle(scale * .005, _color2.default.to_pixi(_color2.default.brighter(color, 100)));\n      /*\n      very strange and beautiful\n      diagram.edges.forEach(edge => {\n        if (!edge[1]) {\n          return;\n        }\n        graphics.moveTo(scale * edge[0][0], scale * edge[0][1]);\n        graphics.lineTo(scale * edge[1][0], scale * edge[1][1]);\n        graphics.closePath();\n      });\n      */\n      triangles.forEach(function (triangle) {\n        // pixi has sharp angles when joining lines in path, so do not use path\n        graphics.moveTo(scale * triangle[0].x, scale * triangle[0].y);\n        graphics.lineTo(scale * triangle[1].x, scale * triangle[1].y);\n        graphics.moveTo(scale * triangle[1].x, scale * triangle[1].y);\n        graphics.lineTo(scale * triangle[2].x, scale * triangle[2].y);\n        graphics.moveTo(scale * triangle[2].x, scale * triangle[2].y);\n        graphics.lineTo(scale * triangle[0].x, scale * triangle[0].y);\n      });\n      return graphics;\n    }\n  }], [{\n    key: \"linear\",\n    value: function linear(random) {\n      return random;\n    }\n  }, {\n    key: \"pow\",\n    value: function pow(random) {\n      return Math.pow(random, 0.2);\n    }\n  }]);\n\n  return PointsInCicrle;\n}();\n\nexports.default = PointsInCicrle;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _voronoi_diagram = require(\"common/voronoi_diagram\");\n\nvar _voronoi_diagram2 = _interopRequireDefault(_voronoi_diagram);\n\nvar _color = require(\"common/color\");\n\nvar _color2 = _interopRequireDefault(_color);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar BallsGenerator = function () {\n  function BallsGenerator(diagram, color_map, drawer) {\n    _classCallCheck(this, BallsGenerator);\n\n    this.diagram = diagram;\n    this.color_map = color_map;\n    this.drawer = drawer;\n  }\n\n  _createClass(BallsGenerator, [{\n    key: \"generate\",\n    value: function generate() {\n      var num_balls = 0.6 * this.drawer.map.view.width * this.drawer.map.view.height | 0;\n      console.log('num_balls', num_balls);\n      var ball_radius_min = 1;\n      var ball_radius_max = 5;\n      var color_step = 5;\n      var color_count = 2;\n      var graphics = new PIXI.Graphics();\n      while (num_balls--) {\n        var rx = _util2.default.rand(1, this.drawer.map.view.width - 1);\n        var ry = _util2.default.rand(1, this.drawer.map.view.height - 1);\n        var cell = _voronoi_diagram2.default.find({ x: rx, y: ry }, this.diagram);\n        var base = this.color_map[cell.geo_type];\n        var color = _color2.default.random_near(base, color_step, color_count);\n        var radius = _util2.default.rand(ball_radius_min, ball_radius_max);\n        graphics.beginFill(_color2.default.to_pixi(color));\n        graphics.drawCircle(rx, ry, radius);\n        graphics.endFill();\n      }\n      var texture = graphics.generateCanvasTexture(PIXI.SCALE_MODES.LINEAR);\n      var sprite = new PIXI.Sprite(texture);\n      this.drawer.layers['geo'].addChild(sprite);\n    }\n  }]);\n\n  return BallsGenerator;\n}();\n\nexports.default = BallsGenerator;\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _collapsible_panel = require('common/components/collapsible_panel');\n\nvar _collapsible_panel2 = _interopRequireDefault(_collapsible_panel);\n\nvar _debug_info = require('geo/components/debug_info');\n\nvar _debug_info2 = _interopRequireDefault(_debug_info);\n\nvar _generate_world_form = require('geo/components/generate_world_form');\n\nvar _generate_world_form2 = _interopRequireDefault(_generate_world_form);\n\nvar _drawing_settings_form = require('geo/components/drawing_settings_form');\n\nvar _drawing_settings_form2 = _interopRequireDefault(_drawing_settings_form);\n\nvar _roads_form = require('geo/components/roads_form');\n\nvar _roads_form2 = _interopRequireDefault(_roads_form);\n\nvar _legend = require('geo/components/legend');\n\nvar _legend2 = _interopRequireDefault(_legend);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar App = function (_React$Component) {\n  _inherits(App, _React$Component);\n\n  function App() {\n    _classCallCheck(this, App);\n\n    return _possibleConstructorReturn(this, (App.__proto__ || Object.getPrototypeOf(App)).apply(this, arguments));\n  }\n\n  _createClass(App, [{\n    key: 'render',\n    value: function render() {\n      return _react2.default.createElement(\n        'table',\n        { style: { margin: '5px', borderSpacing: '5px', borderCollapse: 'separate' } },\n        _react2.default.createElement(\n          'tbody',\n          null,\n          _react2.default.createElement(\n            'tr',\n            { style: { verticalAlign: 'top' } },\n            _react2.default.createElement(\n              'td',\n              null,\n              _react2.default.createElement(\n                'div',\n                { className: 'panel-group' },\n                _react2.default.createElement(\n                  'div',\n                  { className: 'panel panel-success' },\n                  _react2.default.createElement(\n                    'div',\n                    { className: 'panel-body' },\n                    _react2.default.createElement(\n                      'div',\n                      { className: '', id: 'map_container' },\n                      _react2.default.createElement('canvas', { id: 'map', width: '800', height: '800' })\n                    )\n                  )\n                ),\n                _react2.default.createElement(_collapsible_panel2.default, { header: 'debug', name: 'debug', content_func: function content_func() {\n                    return _react2.default.createElement(_debug_info2.default);\n                  } })\n              )\n            ),\n            _react2.default.createElement(\n              'td',\n              { width: '100%' },\n              _react2.default.createElement(\n                'div',\n                { className: 'panel-group' },\n                _react2.default.createElement(\n                  'div',\n                  { className: 'panel panel-success' },\n                  _react2.default.createElement(\n                    'div',\n                    { className: 'panel-body' },\n                    _react2.default.createElement(_collapsible_panel2.default, { header: 'world generating', name: 'generate_world', content_func: function content_func() {\n                        return _react2.default.createElement(_generate_world_form2.default);\n                      } }),\n                    _react2.default.createElement(_collapsible_panel2.default, { header: 'drawing settings', name: 'drawing_settings', content_func: function content_func() {\n                        return _react2.default.createElement(_drawing_settings_form2.default);\n                      } }),\n                    _react2.default.createElement(_collapsible_panel2.default, { header: 'roads', name: 'roads', content_func: function content_func() {\n                        return _react2.default.createElement(_roads_form2.default);\n                      } })\n                  ),\n                  _react2.default.createElement(\n                    'div',\n                    { className: 'panel-footer' },\n                    _react2.default.createElement(_collapsible_panel2.default, { header: 'legend', name: 'legend', content_func: function content_func() {\n                        return _react2.default.createElement(_legend2.default);\n                      } })\n                  )\n                )\n              )\n            )\n          )\n        )\n      );\n    }\n  }]);\n\n  return App;\n}(_react2.default.Component);\n\nexports.default = App;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = require(\"react\");\n\nvar _react2 = _interopRequireDefault(_react);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar DebugInfo = function (_React$Component) {\n  _inherits(DebugInfo, _React$Component);\n\n  function DebugInfo() {\n    _classCallCheck(this, DebugInfo);\n\n    return _possibleConstructorReturn(this, (DebugInfo.__proto__ || Object.getPrototypeOf(DebugInfo)).apply(this, arguments));\n  }\n\n  _createClass(DebugInfo, [{\n    key: \"render\",\n    value: function render() {\n      return _react2.default.createElement(\n        \"div\",\n        null,\n        _react2.default.createElement(\n          \"div\",\n          null,\n          \"FPS: \",\n          _react2.default.createElement(\"span\", { id: \"fps_counter\" })\n        ),\n        _react2.default.createElement(\n          \"div\",\n          null,\n          \"map scale: \",\n          _react2.default.createElement(\"span\", { id: \"map_scale\" })\n        ),\n        _react2.default.createElement(\n          \"div\",\n          null,\n          \"mouse position: \",\n          _react2.default.createElement(\n            \"span\",\n            { id: \"mouse_pos\" },\n            (0, 0)\n          )\n        ),\n        _react2.default.createElement(\n          \"div\",\n          null,\n          \"world point: \",\n          _react2.default.createElement(\n            \"span\",\n            { id: \"world_pos\" },\n            (0, 0)\n          )\n        )\n      );\n    }\n  }]);\n\n  return DebugInfo;\n}(_react2.default.Component);\n\nexports.default = DebugInfo;\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _input_spinner = require('common/components/input_spinner');\n\nvar _input_spinner2 = _interopRequireDefault(_input_spinner);\n\nvar _active_checkbox = require('common/components/active_checkbox');\n\nvar _active_checkbox2 = _interopRequireDefault(_active_checkbox);\n\nvar _game = require('geo/game');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar DrawingSettingsForm = function (_React$Component) {\n  _inherits(DrawingSettingsForm, _React$Component);\n\n  _createClass(DrawingSettingsForm, [{\n    key: 'submit',\n    value: function submit(e) {\n      e.preventDefault();\n    }\n  }]);\n\n  function DrawingSettingsForm() {\n    _classCallCheck(this, DrawingSettingsForm);\n\n    return _possibleConstructorReturn(this, (DrawingSettingsForm.__proto__ || Object.getPrototypeOf(DrawingSettingsForm)).call(this));\n  }\n\n  _createClass(DrawingSettingsForm, [{\n    key: 'checkbox_handler',\n    value: function checkbox_handler(event, checkbox_type) {\n      _game.game.map_drawer.draw_voronoi_diagram = !_game.game.map_drawer.draw_voronoi_diagram;\n      _game.game.map_drawer.set_layers_visibility();\n      this.setState({});\n    }\n  }, {\n    key: 'create_checkbox',\n    value: function create_checkbox(prop_name, text) {\n      return _react2.default.createElement(_active_checkbox2.default, {\n        checked: _game.game.map_drawer[prop_name],\n        handler: function handler() {\n          _game.game.map_drawer[prop_name] = !_game.game.map_drawer[prop_name];\n          _game.game.map_drawer.set_layers_visibility();\n          return _game.game.map_drawer[prop_name];\n        },\n        text: text\n      });\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      return _react2.default.createElement(\n        'div',\n        null,\n        _react2.default.createElement(\n          'form',\n          { className: 'form-horizontal' },\n          this.create_checkbox('draw_voronoi_diagram', 'draw voronoi diagram')\n        )\n      );\n    }\n  }]);\n\n  return DrawingSettingsForm;\n}(_react2.default.Component);\n\nexports.default = DrawingSettingsForm;\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _input_spinner = require('common/components/input_spinner');\n\nvar _input_spinner2 = _interopRequireDefault(_input_spinner);\n\nvar _game = require('geo/game');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar GenerateWorldForm = function (_React$Component) {\n  _inherits(GenerateWorldForm, _React$Component);\n\n  function GenerateWorldForm() {\n    _classCallCheck(this, GenerateWorldForm);\n\n    return _possibleConstructorReturn(this, (GenerateWorldForm.__proto__ || Object.getPrototypeOf(GenerateWorldForm)).apply(this, arguments));\n  }\n\n  _createClass(GenerateWorldForm, [{\n    key: 'submit',\n    value: function submit(e) {\n      _game.game.rrt_epsilon = parseInt(document.querySelector('#gwf_rrt_epsilon').value);\n      e.preventDefault();\n      console.clear();\n      _game.game.map_drawer.map.stage.children.forEach(function (layer) {\n        return layer.removeChildren();\n      });\n      _game.game.generate_map();\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      return _react2.default.createElement(\n        'div',\n        null,\n        _react2.default.createElement(\n          'form',\n          { className: 'form-horizontal' },\n          _react2.default.createElement(\n            'div',\n            { className: 'form-group' },\n            _react2.default.createElement(\n              'label',\n              { htmlFor: 'epsilon', className: 'col-sm-4 control-label' },\n              'rrt nodes distance'\n            ),\n            _react2.default.createElement(\n              'div',\n              { className: 'col-sm-8' },\n              _react2.default.createElement(_input_spinner2.default, { name: 'gwf_rrt_epsilon', value: _game.game.rrt_epsilon })\n            )\n          ),\n          _react2.default.createElement(\n            'div',\n            { className: 'form-group' },\n            _react2.default.createElement(\n              'div',\n              { className: 'col-sm-offset-4 col-sm-8' },\n              _react2.default.createElement(\n                'button',\n                { type: 'button', className: 'btn btn-default', id: 'generate_world', onClick: this.submit.bind(this) },\n                'generate'\n              )\n            )\n          )\n        )\n      );\n    }\n  }]);\n\n  return GenerateWorldForm;\n}(_react2.default.Component);\n\nexports.default = GenerateWorldForm;\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Legend = function (_React$Component) {\n  _inherits(Legend, _React$Component);\n\n  function Legend() {\n    _classCallCheck(this, Legend);\n\n    return _possibleConstructorReturn(this, (Legend.__proto__ || Object.getPrototypeOf(Legend)).apply(this, arguments));\n  }\n\n  _createClass(Legend, [{\n    key: 'render',\n    value: function render() {\n      return _react2.default.createElement(\n        'div',\n        null,\n        _react2.default.createElement(\n          'p',\n          null,\n          'here will be map legend...'\n        )\n      );\n    }\n  }]);\n\n  return Legend;\n}(_react2.default.Component);\n\nexports.default = Legend;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = require(\"react\");\n\nvar _react2 = _interopRequireDefault(_react);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar RoadsForm = function (_React$Component) {\n  _inherits(RoadsForm, _React$Component);\n\n  function RoadsForm() {\n    _classCallCheck(this, RoadsForm);\n\n    return _possibleConstructorReturn(this, (RoadsForm.__proto__ || Object.getPrototypeOf(RoadsForm)).apply(this, arguments));\n  }\n\n  _createClass(RoadsForm, [{\n    key: \"render\",\n    value: function render() {\n      return _react2.default.createElement(\n        \"div\",\n        null,\n        _react2.default.createElement(\n          \"form\",\n          { className: \"form-horizontal\" },\n          _react2.default.createElement(\n            \"p\",\n            null,\n            \"in test mode for now, nothing works...\"\n          ),\n          _react2.default.createElement(\n            \"button\",\n            { type: \"button\", className: \"btn btn-success\", id: \"build_road\" },\n            \"build road\"\n          ),\n          _react2.default.createElement(\"div\", { id: \"road_text\" })\n        )\n      );\n    }\n  }]);\n\n  return RoadsForm;\n}(_react2.default.Component);\n\nexports.default = RoadsForm;\n","\"use strict\";\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _voronoi_diagram = require(\"common/voronoi_diagram\");\n\nvar _voronoi_diagram2 = _interopRequireDefault(_voronoi_diagram);\n\nvar _regions_gatherer = require(\"geo/regions_gatherer\");\n\nvar _regions_gatherer2 = _interopRequireDefault(_regions_gatherer);\n\nvar _rrt_diagram = require(\"geo/rrt_diagram\");\n\nvar _rrt_diagram2 = _interopRequireDefault(_rrt_diagram);\n\nvar _geo = require(\"geo/geo\");\n\nvar _geo2 = _interopRequireDefault(_geo);\n\nvar _a_star = require(\"common/a_star\");\n\nvar _a_star2 = _interopRequireDefault(_a_star);\n\nvar _interaction = require(\"geo/interaction\");\n\nvar _interaction2 = _interopRequireDefault(_interaction);\n\nvar _map_drawer = require(\"geo/map_drawer\");\n\nvar _map_drawer2 = _interopRequireDefault(_map_drawer);\n\nvar _app = require(\"geo/components/app\");\n\nvar _app2 = _interopRequireDefault(_app);\n\nvar _reactDom = require(\"react-dom\");\n\nvar _reactDom2 = _interopRequireDefault(_reactDom);\n\nvar _react = require(\"react\");\n\nvar _react2 = _interopRequireDefault(_react);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Game = function () {\n  function Game() {\n    _classCallCheck(this, Game);\n\n    // CONST\n    this.width = 800;\n    this.height = 800;\n    this.cells_count = Infinity;\n    this.rrt_epsilon = 35;\n    this.rrt_reject_limit = 500;\n    this.map_drawer = new _map_drawer2.default();\n    this.interaction = new _interaction2.default();\n  }\n\n  _createClass(Game, [{\n    key: \"generate_map\",\n    value: function generate_map() {\n      var _this = this;\n\n      this.rrt = new _rrt_diagram2.default(this.width, this.height);\n      this.rrt.generate(this.rrt_epsilon, this.cells_count, this.rrt_reject_limit);\n      this.diagram = _voronoi_diagram2.default.generate(this.rrt.nodes, this.width, this.height);\n\n      // find closes point\n      this.diagram.cells.forEach(function (cell) {\n        return cell.closest_backlinks = [];\n      });\n      this.diagram.cells.forEach(function (cell) {\n        cell.closest_link = cell.links[0];\n        _util2.default.push_uniq(cell, cell.closest_link.closest_backlinks);\n      });\n\n      // find close-to-border \n      this.diagram.cells.forEach(function (cell) {\n        cell.on_border = false;\n      });\n      this.diagram.edges.forEach(function (edge) {\n        if (!edge.right) {\n          edge.on_border = true;\n          edge.from.on_border = true;\n          edge.to.on_border = true;\n          _this.diagram.cells[edge.left.index].on_border = true;\n        }\n      });\n\n      this.map_drawer.init(this.diagram, this.rrt, this.width, this.height);\n      this.interaction.init();\n      this.geo = new _geo2.default(this.diagram, this.rrt, this.map_drawer);\n      this.map_drawer.draw();\n\n      this.map_drawer.highlight_bad_river_links();\n      this.map_drawer.highlight_local_minimums();\n      //this.map_drawer.print_text_for_each_cell(cell => cell.fertility);\n    }\n  }]);\n\n  return Game;\n}();\n\nvar game = new Game();\nmodule.exports.game = game; // OMG global export BAD WAY\n\ndocument.addEventListener('DOMContentLoaded', function () {\n  _reactDom2.default.render(_react2.default.createElement(_app2.default, null), document.querySelector('#app'));\n  game.generate_map();\n});\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _rrt_diagram = require(\"geo/rrt_diagram\");\n\nvar _rrt_diagram2 = _interopRequireDefault(_rrt_diagram);\n\nvar _rivers_and_lakes_generator = require(\"geo/rivers_and_lakes_generator\");\n\nvar _rivers_and_lakes_generator2 = _interopRequireDefault(_rivers_and_lakes_generator);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Geo = function () {\n  function Geo(diagram, rrt, map_drawer) {\n    _classCallCheck(this, Geo);\n\n    this.map_drawer = map_drawer;\n    this.sea_ratio = 0.3;\n    this.rock_height_ratio = 0.75;\n    this.rrt_regions = 3;\n    this.diagram = diagram;\n    this.rrt = rrt;\n    var max_branch_order = _util2.default.find_min_and_max(this.rrt.nodes, function (node) {\n      return node.branch_order;\n    }).max;\n    console.log('WE GONNA remove_some_links_and_recalc_all', this.rrt_regions - 1);\n    var deleted_links = this.rrt.remove_some_links_and_recalc_all(this.rrt_regions - 1, max_branch_order - 10, max_branch_order - 2);\n    var centers = this.rrt.nodes.filter(function (node) {\n      return node.generation == 0;\n    });\n    console.log('rrt centers', centers);\n    this.init_height();\n    this.generate_heights_by_rrt_generations();\n    this.generate_heights_by_rrt_branches_length();\n    this.height_smooth(); // experimental\n    this.set_nodes_height_by_cell_height();\n    this.generate_sea(this.sea_ratio);\n\n    //this.map_drawer.print_text_for_each_cell(cell => cell.branch_order);\n    this.rrt.restore_removed_links(deleted_links);\n    this.map_drawer.highlight_deleted_links(deleted_links);\n\n    this.generate_rivers();\n    this.generate_rocks_by_height();\n    this.calc_fertility();\n    this.geo_types_by_fertility();\n  }\n\n  _createClass(Geo, [{\n    key: \"generate_sea\",\n    value: function generate_sea(sea_ratio) {\n      var _this = this;\n\n      var sea_cells_threshold = Math.floor(sea_ratio * this.diagram.cells.length);\n      var count_sea_cells = 0;\n\n      var _loop = function _loop(i) {\n        if (count_sea_cells >= sea_cells_threshold) {\n          return \"break\";\n        }\n        var open_list = [];\n        _this.diagram.cells.forEach(function (cell) {\n          if (cell.height <= i && cell.geo_type != 'sea') {\n            open_list.push(cell);\n          }\n        });\n        var length_before = void 0;\n        do {\n          length_before = open_list.length;\n          open_list = open_list.filter(function (cell) {\n            // we dont set sea type to inland regions, only to connected to other seas\n            if (cell.on_border || cell.links.some(function (c) {\n              return c.geo_type == 'sea';\n            })) {\n              cell.geo_type = 'sea';\n              count_sea_cells++;\n              return false;\n            }\n            return true;\n          });\n        } while (open_list.length && length_before != open_list.length);\n      };\n\n      for (var i in this.heights_stat()) {\n        var _ret = _loop(i);\n\n        if (_ret === \"break\") break;\n      }\n      // set shores\n      this.diagram.cells.forEach(function (cell) {\n        cell.shore = cell.geo_type != 'sea' && cell.links.some(function (c) {\n          return c.geo_type == 'sea';\n        });\n      });\n    }\n  }, {\n    key: \"generate_rocks_by_height\",\n    value: function generate_rocks_by_height() {\n      var _this2 = this;\n\n      var max_height = _util2.default.find_min_and_max(this.rrt.nodes, function (e) {\n        return e.height;\n      }).max;\n      this.rock_from_height = Math.ceil(this.rock_height_ratio * max_height);\n      this.diagram.cells.forEach(function (cell) {\n        if (cell.height >= _this2.rock_from_height) {\n          cell.geo_type = 'rock';\n        }\n      });\n    }\n  }, {\n    key: \"generate_rivers\",\n    value: function generate_rivers() {\n      _rivers_and_lakes_generator2.default.generate_by_edges(this.diagram);\n    }\n  }, {\n    key: \"calc_fertility\",\n    value: function calc_fertility() {\n      var square_sum = 0;\n      this.diagram.cells.forEach(function (cell) {\n        return square_sum += _util2.default.convex_polygon_square(cell.nodes);\n      });\n      var fertility_multiplier = Math.round(square_sum / this.diagram.cells.length);\n\n      this.diagram.cells.forEach(function (cell) {\n        if (cell.geo_type == 'sea') {\n          cell.fertility = 0;\n          return;\n        }\n        var sum_rivers_strength = 0;\n        var square = _util2.default.convex_polygon_square(cell.nodes);\n        cell.nodes.forEach(function (node) {\n          return sum_rivers_strength += node.river ? node.river.strength : 0;\n        });\n        cell.fertility = Math.ceil(fertility_multiplier * sum_rivers_strength / square);\n      });\n    }\n  }, {\n    key: \"geo_types_by_fertility\",\n    value: function geo_types_by_fertility() {\n      var stats = [];\n      this.diagram.cells.forEach(function (cell) {\n        return _util2.default.push_uniq(cell.fertility, stats);\n      });\n      stats.sort(function (e1, e2) {\n        return e1 - e2;\n      });\n      var min = stats[0];\n      var max = stats[Math.floor(0.95 * stats.length)]; // 95% persentile cause there's big gaps in the end\n      var geo_type_fertility_thresholds = {\n        bog: _util2.default.normalize_value(0.55, 1, max, 0, min),\n        grass: _util2.default.normalize_value(0.15, 1, max, 0, min),\n        steppe: _util2.default.normalize_value(0.05, 1, max, 0, min),\n        desert: _util2.default.normalize_value(0.0, 1, max, 0, min)\n      };\n\n      this.diagram.cells.forEach(function (cell) {\n        if (cell.geo_type) {\n          return;\n        }\n        for (var i in geo_type_fertility_thresholds) {\n          if (cell.fertility >= geo_type_fertility_thresholds[i]) {\n            cell.geo_type = i;\n            break;\n          }\n        }\n      });\n    }\n  }, {\n    key: \"init_height\",\n    value: function init_height() {\n      this.rrt.nodes.forEach(function (node) {\n        return node.height = 0;\n      });\n    }\n  }, {\n    key: \"generate_heights_by_rrt_branches_length\",\n    value: function generate_heights_by_rrt_branches_length() {\n      var step = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 10;\n      var floor_level = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n\n      this.rrt.nodes.forEach(function (node) {\n        return node.height += step * node.branch_order + floor_level;\n      });\n    }\n  }, {\n    key: \"height_smooth\",\n    value: function height_smooth() {\n      var max_diff_coef = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0.3;\n\n      var h = _util2.default.find_min_and_max(this.rrt.nodes, function (node) {\n        return node.height;\n      });\n      var max_diff = max_diff_coef * (h.max - h.min);\n      var changed = 0;\n      do {\n        changed = 0;\n        this.diagram.cells.forEach(function (cell) {\n          var max_height = _util2.default.find_min_and_max(cell.links, function (c) {\n            return c.height;\n          }).max;\n          var height_to_max_diff = max_height - max_diff;\n          if (cell.height < height_to_max_diff) {\n            cell.height = height_to_max_diff;\n            changed++;\n          }\n        });\n        console.log('height smooth cycle cells changed', changed);\n      } while (changed > 0);\n    }\n  }, {\n    key: \"generate_heights_by_rrt_generations\",\n    value: function generate_heights_by_rrt_generations() {\n      var peak_max_height = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 200;\n      var peak_min_height = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 200;\n      var step = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 2;\n\n      var peak_height = _util2.default.rand(peak_min_height, peak_max_height);\n      this.rrt.nodes.forEach(function (node) {\n        return node.height += Math.max(node.height, peak_height - step * node.generation);\n      });\n    }\n  }, {\n    key: \"set_nodes_height_by_cell_height\",\n    value: function set_nodes_height_by_cell_height() {\n      this.diagram.nodes.forEach(function (node) {\n        //node.height = Math.round(node.cells.reduce((acc, cell) => cell.height + acc, 0) / node.cells.length);\n        node.height = _util2.default.find_min_and_max(node.cells, function (cell) {\n          return cell.height;\n        }).min;\n      });\n    }\n\n    // for seas and like that\n\n  }, {\n    key: \"heights_stat\",\n    value: function heights_stat() {\n      var stat = [];\n      this.diagram.cells.forEach(function (cell) {\n        if (!stat[cell.height]) stat[cell.height] = 0;\n        stat[cell.height]++;\n      });\n      //stat.forEach((e, i) => console.log('height', i, e));\n      return stat;\n    }\n  }]);\n\n  return Geo;\n}();\n\nexports.default = Geo;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _voronoi_diagram = require(\"common/voronoi_diagram\");\n\nvar _voronoi_diagram2 = _interopRequireDefault(_voronoi_diagram);\n\nvar _d = require(\"d3\");\n\nvar d3 = _interopRequireWildcard(_d);\n\nvar _game = require(\"geo/game\");\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Interaction = function () {\n  function Interaction() {\n    _classCallCheck(this, Interaction);\n\n    this.cell_under_cursor = null;\n    this.state = 'initial';\n  }\n\n  _createClass(Interaction, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      this.game = _game.game;\n      document.getElementById('build_road').onclick = this.build_road_button_handler.bind(this);\n      this.map = this.game.map_drawer.map;\n      this.map.stage.interactive = true;\n\n      document.addEventListener('mousemove', this.map_mouse_move_handler.bind(this), false);\n\n      d3.select('#map').on('click', this.map_click_handler.bind(this));\n\n      // from https://bl.ocks.org/pkerpedjiev/cf791db09ebcabaec0669362f4df1776\n      d3.select('#map').call(d3.zoom().scaleExtent([1, 4]).translateExtent([[0, 0], [this.map.view.width, this.map.view.height]]).on(\"zoom\", this.map_zoom.bind(this)));\n\n      this.road_text_div = document.getElementById(\"road_text\");\n\n      this.ticks = 0; // here?\n      this.fps_div = document.getElementById('fps_counter');\n      this.map.ticker.add(function () {\n        _this.ticks++;\n        if (_this.ticks % 10 == 0) {\n          d3.select('#fps_counter').html(_this.map.ticker.FPS | 0);\n        }\n      });\n      this.update_map_scale();\n    }\n  }, {\n    key: \"change_state\",\n    value: function change_state(state) {\n      this.state = state;\n      if (state == 'initial') {\n        d3.select('#road_text').html('');\n        this.road_start_cell = null;\n      } else if (state == 'build_road_choose_start') {\n        d3.select('#road_text').html('click road start cell');\n        this.road_start_cell = null;\n      } else if (state == 'build_road_choose_finish') {\n        d3.select('#road_text').html('click road finish cell');\n      } else if (state == 'build_road') {\n        //this.game.build_road(this.road_start_cell, this.road_finish_cell);\n        console.log('suppose the road is built now');\n        this.change_state('initial');\n      }\n    }\n\n    //\n    //  user actions handlers\n    //\n\n  }, {\n    key: \"build_road_button_handler\",\n    value: function build_road_button_handler(args) {\n      this.change_state('build_road_choose_start');\n    }\n  }, {\n    key: \"map_mouse_move_handler\",\n    value: function map_mouse_move_handler(event) {\n      if (event.target != this.map.view) {\n        this.game.map_drawer.clear_cell_under_cursor();\n        this.cell_under_cursor = null;\n        return false;\n      }\n      var mouse_coords = this.get_mouse_coords(event);\n      // TODO check if its fast enought\n      var cell = this.get_cell_under_cursor(mouse_coords);\n      if (!this.cell_under_cursor || this.cell_under_cursor != cell) {\n        this.game.map_drawer.highlight_cell_under_cursor(cell);\n        this.cell_under_cursor = cell;\n      }\n\n      d3.select('#mouse_pos').html('{x: ' + mouse_coords.x + ', y: ' + mouse_coords.y + '}');\n      var world_pos = this.mouse_coords_to_world_coords(mouse_coords);\n      d3.select('#world_pos').html('{x: ' + world_pos.x + ', y: ' + world_pos.y + '}');\n    }\n  }, {\n    key: \"map_click_handler\",\n    value: function map_click_handler() {\n      var mouse_coords = this.get_mouse_coords(d3.event);\n      var cell = this.get_cell_under_cursor(mouse_coords);\n      if (!cell) {\n        console.log('dunno why, but no cell under cursor');\n        return false;\n      }\n      console.log('mouse click cell under cursor', cell);\n      if (this.state == 'build_road_choose_start') {\n        this.road_start_cell = cell;\n        this.change_state('build_road_choose_finish');\n      } else if (this.state == 'click road finish cell') {\n        this.road_finish_cell = cell;\n        this.change_state('build_road');\n      }\n    }\n  }, {\n    key: \"map_zoom\",\n    value: function map_zoom() {\n      this.map.stage.position.x = d3.event.transform.x;\n      this.map.stage.position.y = d3.event.transform.y;\n      this.map.stage.scale.x = d3.event.transform.k;\n      this.map.stage.scale.y = d3.event.transform.k;\n      this.update_map_scale();\n    }\n    ///////////////////////////////////////\n\n\n  }, {\n    key: \"update_map_scale\",\n    value: function update_map_scale() {\n      d3.select('#map_scale').html('{x: ' + this.map.stage.scale.x + ', y: ' + this.map.stage.scale.y + '}');\n    }\n\n    ///////////////////////////////////////  \n    // UTILS\n    ///////////////////////////////////////\n\n  }, {\n    key: \"get_mouse_coords\",\n    value: function get_mouse_coords(event) {\n      return { x: event.offsetX, y: event.offsetY };\n    }\n  }, {\n    key: \"get_cell_under_cursor\",\n    value: function get_cell_under_cursor(mouse_coords) {\n      var world_coords = this.mouse_coords_to_world_coords(mouse_coords);\n      return _voronoi_diagram2.default.find(world_coords, this.game.map_drawer.diagram);\n    }\n  }, {\n    key: \"mouse_coords_to_world_coords\",\n    value: function mouse_coords_to_world_coords(mouse_coords) {\n      var xn = Math.floor((mouse_coords.x - this.map.stage.position.x) / this.map.stage.scale.x),\n          yn = Math.floor((mouse_coords.y - this.map.stage.position.y) / this.map.stage.scale.y);\n      return { x: xn, y: yn };\n    }\n  }]);\n\n  return Interaction;\n}();\n\nexports.default = Interaction;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _rrt_diagram = require(\"geo/rrt_diagram\");\n\nvar _rrt_diagram2 = _interopRequireDefault(_rrt_diagram);\n\nvar _texture_generator = require(\"geo/texture_generator\");\n\nvar _texture_generator2 = _interopRequireDefault(_texture_generator);\n\nvar _balls_generator = require(\"geo/balls_generator\");\n\nvar _balls_generator2 = _interopRequireDefault(_balls_generator);\n\nvar _color = require(\"common/color\");\n\nvar _color2 = _interopRequireDefault(_color);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar MapDrawer = function () {\n  function MapDrawer() {\n    _classCallCheck(this, MapDrawer);\n  }\n\n  _createClass(MapDrawer, [{\n    key: \"init\",\n    value: function init(diagram, rrt, width, height) {\n      var _this = this;\n\n      var PIXI = require('pixi.js');\n      this.map = new PIXI.Application(width, height, {\n        backgroundColor: _color2.default.to_pixi([0, 0, 0]),\n        antialias: true,\n        view: document.getElementById('map')\n      });\n      console.log('renderer', this.map.renderer);\n      this.layers = {};\n      MapDrawer.layers().forEach(function (layer) {\n        _this.layers[layer] = new PIXI.Container();\n        _this.map.stage.addChild(_this.layers[layer]);\n      });\n      document.getElementById('map_container').appendChild(this.map.view);\n      this.diagram = diagram;\n      this.rrt = rrt;\n    }\n  }, {\n    key: \"draw\",\n    value: function draw() {\n      this.draw_voronoi_diagram = true;\n      this.draw_rrt_links = true;\n      this.draw_arrows = false;\n      this.draw_height = false;\n      this.draw_rivers = true;\n      this.draw_geo_types = true;\n      this.dark_mode = false; // DEBUG MODE\n      var water_color = [0, 50, 200];\n\n      this.init_heignts();\n      this.init_geo_types();\n      this.init_arrows();\n      this.init_rrt();\n      this.init_rivers(water_color);\n\n      var rg = new PIXI.Graphics();\n      this.layers['water'].addChild(rg);\n      this.diagram.cells.forEach(function (cell) {\n        if (cell.geo_type == 'lake') {\n          MapDrawer.draw_smoothed_polygon(rg, cell.nodes, cell, water_color);\n        }\n      });\n      this.init_dark_mode();\n\n      this.set_layers_visibility();\n    }\n  }, {\n    key: \"set_layers_visibility\",\n    value: function set_layers_visibility() {\n      this.layers['heights'].visible = this.draw_height;\n      this.layers['geo'].visible = this.draw_geo_types;\n      this.layers['arrows'].visible = this.draw_arrows;\n      this.layers['rrt_links'].visible = this.draw_rrt_links;\n      this.layers['water'].visible = this.draw_rivers;\n      if (!this.draw_voronoi_diagram) {\n        this.layers['regions'].visible = false;\n        this.layers['geo'].visible = false;\n        this.layers['heights'].visible = false;\n      }\n      this.layers['dim_cells'].visible = this.dark_mode;\n      this.layers['dim'].visible = this.dark_mode;\n    }\n  }, {\n    key: \"clear_cell_under_cursor\",\n    value: function clear_cell_under_cursor() {\n      this.layers['under_cursor'].removeChildren();\n    }\n  }, {\n    key: \"highlight_cell_under_cursor\",\n    value: function highlight_cell_under_cursor(cell) {\n      this.clear_cell_under_cursor();\n      var polygon = cell.nodes.map(function (node) {\n        return new PIXI.Point(node.x, node.y);\n      });\n      var border_graphics = new PIXI.Graphics();\n      border_graphics.alpha = 0.75;\n      border_graphics.lineStyle(3, _color2.default.to_pixi([218, 165, 32]));\n      border_graphics.drawPolygon(polygon);\n      border_graphics.closePath(); // strange, but it needed here. some edges are thin without it\n      var inner_graphics = new PIXI.Graphics();\n      inner_graphics.alpha = 0.35;\n      inner_graphics.beginFill(_color2.default.to_pixi([255, 255, 255]));\n      inner_graphics.drawPolygon(polygon);\n      inner_graphics.closePath(); // strange, but it needed here. some edges are thin without it\n      inner_graphics.endFill();\n\n      this.layers['under_cursor'].addChild(border_graphics);\n      this.layers['under_cursor'].addChild(inner_graphics);\n    }\n  }, {\n    key: \"init_rivers\",\n    value: function init_rivers(water_color) {\n      var draw_arrows = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n      var graphics = new PIXI.Graphics();\n      var graphics_arrows = new PIXI.Graphics();\n      graphics_arrows.alpha = 0.5;\n      this.diagram.nodes.forEach(function (node) {\n        if (!node.river) return;\n        if (node.river.strength === 0) {\n          //let dry_river_color = [121, 96, 76];\n          var dry_river_color = [87, 65, 47];\n          graphics.lineStyle(2, _color2.default.to_pixi(dry_river_color));\n        } else {\n          graphics.lineStyle(MapDrawer.get_line_width_for_river(node.river.strength), _color2.default.to_pixi(water_color));\n        }\n        node.river.children.forEach(function (child) {\n          graphics.moveTo(node.x, node.y);\n          graphics.lineTo(child.x, child.y);\n          graphics.closePath();\n          MapDrawer.draw_arrow(node, child, graphics_arrows, 1, [200, 100, 0]);\n        });\n      });\n      this.layers['water'].addChild(graphics);\n      if (draw_arrows) this.layers['water'].addChild(graphics_arrows);\n    }\n  }, {\n    key: \"highlight_bad_river_links\",\n    value: function highlight_bad_river_links() {\n      var graphics = new PIXI.Graphics();\n      graphics.alpha = 0.5;\n      this.diagram.nodes.forEach(function (node) {\n        if (!node.river) return;\n        node.river.children.forEach(function (child) {\n          if (child.height > node.height) {\n            console.log('river flows up', child.height, node.height);\n            graphics.lineStyle(MapDrawer.get_line_width_for_river(node.river.strength), _color2.default.to_pixi([200, 50, 0]));\n            graphics.moveTo(node.x, node.y);\n            graphics.lineTo(child.x, child.y);\n            graphics.closePath();\n          }\n        });\n      });\n\n      this.layers['water'].addChild(graphics);\n    }\n  }, {\n    key: \"highlight_local_minimums\",\n    value: function highlight_local_minimums() {\n      var _this2 = this;\n\n      this.diagram.cells.forEach(function (cell) {\n        if (cell.geo_type == 'sea') return;\n        if (cell.links.every(function (link) {\n          return link.height > cell.height;\n        })) {\n          var graphics = MapDrawer.draw_polygon(cell.nodes, [255, 0, 125]);\n          graphics.alpha = 0.5;\n          _this2.layers['errors'].addChild(graphics);\n          console.log('inland local minimum', cell.x, cell.y);\n        }\n      });\n    }\n  }, {\n    key: \"print_text_for_each_cell\",\n    value: function print_text_for_each_cell(fn) {\n      var _this3 = this;\n\n      this.diagram.cells.forEach(function (cell) {\n        var msg = fn(cell);\n        var text = new PIXI.Text(msg, { fontFamily: 'Arial', fontSize: 10, fill: 0xff1010 });\n        text.x = cell.x + 2;\n        text.y = cell.y;\n        _this3.layers['errors'].addChild(text);\n      });\n    }\n  }, {\n    key: \"highlight_deleted_links\",\n    value: function highlight_deleted_links(deleted_links) {\n      var graphics = new PIXI.Graphics();\n      deleted_links.forEach(function (_ref) {\n        var _ref2 = _slicedToArray(_ref, 2),\n            from = _ref2[0],\n            to = _ref2[1];\n\n        graphics.lineStyle(2, _color2.default.to_pixi([250, 125, 0]));\n        graphics.moveTo(from.x, from.y);\n        graphics.lineTo(to.x, to.y);\n        graphics.closePath();\n      });\n      this.layers['errors'].addChild(graphics);\n    }\n  }, {\n    key: \"init_heignts\",\n    value: function init_heignts() {\n      var _this4 = this;\n\n      var min_height = this.diagram.cells[0].height,\n          max_height = this.diagram.cells[0].height;\n      this.diagram.cells.forEach(function (cell) {\n        if (cell.height < min_height) min_height = cell.height;\n        if (cell.height > max_height) max_height = cell.height;\n      });\n      this.diagram.cells.forEach(function (cell) {\n        var c = _util2.default.normalize_value(cell.height, max_height, 255, min_height, 0);\n        var graphics = MapDrawer.draw_polygon(cell.nodes, [0, c, 0]);\n        _this4.layers['heights'].addChild(graphics); // z-index?\n      });\n    }\n  }, {\n    key: \"init_geo_types\",\n    value: function init_geo_types() {\n      var _this5 = this;\n\n      var geo_types_colors = {\n        sea: [0, 50, 100],\n        rock: [60, 60, 50],\n        //ITS A HACK! its only a background, we draw lake lower with c draw_smoothed_polygon() and blue color\n        lake: [0, 150, 0],\n        bog: [50, 100, 0],\n        grass: [0, 150, 0],\n        steppe: [150, 150, 0],\n        desert: [200, 150, 0]\n      };\n      this.diagram.cells.forEach(function (cell) {\n        if (!geo_types_colors[cell.geo_type]) {\n          throw 'no geo_type color for '.cell.geo_type;\n        }\n        var fill_color = geo_types_colors[cell.geo_type];\n        var graphics = MapDrawer.draw_polygon(cell.nodes, fill_color);\n        _this5.layers['geo'].addChild(graphics);\n      });\n\n      //let balls_generator = new BallsGenerator(this.diagram, geo_types_colors, this);\n      //balls_generator.generate();\n      /*\n      let container = new PIXI.Graphics();\n      let texture_generator = new TextureGenerator();\n      let geo_types_textures = {\n        sea: texture_generator.simple([0, 50, 100]),\n        rock: texture_generator.simple([60, 60, 50]),\n        //ITS A HACK! its only a background, we draw lake lower with c draw_smoothed_polygon() and blue color\n        lake: texture_generator.simple([0, 150, 0]),\n        bog: texture_generator.simple([50, 100, 0]),\n        grass: texture_generator.simple([0, 150, 0]),\n        steppe: texture_generator.simple([150, 150, 0]),\n        desert: texture_generator.simple([200, 150, 0]),\n      };\n      \n      this.diagram.cells.forEach(cell => {\n        if (!geo_types_textures[cell.geo_type]) {\n          throw('no geo_type color for '.cell.geo_type);\n        }\n        let graphics = new PIXI.Graphics();\n        graphics.beginFill(0);\n        graphics.drawPolygon(cell.nodes.map(node => new PIXI.Point(node.x, node.y)));\n        graphics.endFill();\n         let xc = Util.find_min_and_max(cell.nodes, e => e.x);\n        let yc = Util.find_min_and_max(cell.nodes, e => e.y);\n        let sprite = new PIXI.extras.TilingSprite(geo_types_textures[cell.geo_type], xc.max - xc.min, yc.max - yc.min);\n        sprite.x = xc.min;\n        sprite.y = yc.min;\n        sprite.mask = graphics;\n        container.addChild(sprite);\n      });\n      let final_texture = container.generateCanvasTexture(PIXI.SCALE_MODES.NEAREST);\n      let final_sprite = new PIXI.Sprite(final_texture);\n      this.layers['geo'].addChild(final_sprite);\n      */\n    }\n  }, {\n    key: \"init_arrows\",\n    value: function init_arrows() {\n      var graphics = new PIXI.Graphics();\n      this.layers['arrows'].addChild(graphics);\n      this.diagram.cells.forEach(function (cell) {\n        return MapDrawer.draw_arrow(cell, cell.closest_link, graphics, 3, [50, 50, 0]);\n      });\n    }\n  }, {\n    key: \"init_rrt\",\n    value: function init_rrt() {\n      var color = [0, 125, 255].sort(function (e1, e2) {\n        return 0.5 - Math.random();\n      });\n      var graphics = new PIXI.Graphics();\n      this.layers['rrt_links'].addChild(graphics);\n      var bla = _util2.default.find_min_and_max(this.rrt.nodes, function (e) {\n        return e.height;\n      });\n\n      // TODO add diff colors for isolated graphs, use Utildo_while_not_empty() for that\n      this.diagram.cells.forEach(function (cell) {\n        graphics.lineStyle(0, _color2.default.to_pixi([0, 0, 0]));\n        var color_by_height = [_util2.default.normalize_value(cell.height, bla.max, color[0], bla.min, 25), _util2.default.normalize_value(cell.height, bla.max, color[1], bla.min, 25), _util2.default.normalize_value(cell.height, bla.max, color[2], bla.min, 25)];\n        graphics.beginFill(_color2.default.to_pixi(color_by_height));\n        graphics.drawCircle(cell.x, cell.y, 4);\n        graphics.endFill();\n        // all links are drawen twice, but i dont care!\n        cell.rrt_links.forEach(function (link) {\n          graphics.lineStyle(3, _color2.default.to_pixi(color_by_height));\n          graphics.moveTo(cell.x, cell.y);\n          graphics.lineTo(link.x, link.y);\n        });\n      });\n    }\n  }, {\n    key: \"init_dark_mode\",\n    value: function init_dark_mode() {\n      var _this6 = this;\n\n      this.diagram.cells.forEach(function (cell) {\n        var color = cell.geo_type == 'sea' || cell.geo_type == 'lake' ? [0, 0, 100] : [0, 0, 0];\n        var graphics = MapDrawer.draw_polygon(cell.nodes, color);\n        _this6.layers['dim_cells'].addChild(graphics); // z-index?\n      });\n      var g = new PIXI.Graphics();\n      this.layers['dim'].addChild(g);\n      g.alpha = 0.75;\n      g.beginFill = _color2.default.to_pixi([0, 0, 0]);\n      g.drawRect(0, 0, this.map.view.width, this.map.view.height);\n      g.endFill();\n    }\n  }], [{\n    key: \"layers\",\n    value: function layers() {\n      // edges -- test for rivers by edges\n      return [\n      // cells filling\n      'regions', 'geo', 'heights', 'dim_cells',\n      // all items, objects, all that 'upon' the ground\n      'borders', 'water', 'rrt_links', 'arrows', 'edges', 'roads', 'errors',\n      // interaction routines\n      'selection', 'under_cursor',\n      // other\n      'dim'];\n    }\n  }, {\n    key: \"get_line_width_for_river\",\n    value: function get_line_width_for_river(strength) {\n      return 0.5 + Math.log(strength);\n    }\n  }, {\n    key: \"draw_polygon\",\n    value: function draw_polygon(polygon, fill_color) {\n      var graphics = new PIXI.Graphics();\n      graphics.lineStyle(1, _color2.default.to_pixi([0, 30, 0]));\n      graphics.beginFill(_color2.default.to_pixi(fill_color));\n      graphics.drawPolygon(polygon.map(function (node) {\n        return new PIXI.Point(node.x, node.y);\n      }));\n      graphics.closePath(); // strange, but it needed here. some edges are thin without it\n      graphics.endFill();\n      return graphics;\n    }\n\n    // TODO\n\n  }, {\n    key: \"draw_arrow\",\n    value: function draw_arrow(from, to, graphics, line_width, color) {\n      graphics.lineStyle(line_width, _color2.default.to_pixi(color));\n      graphics.moveTo(from.x, from.y);\n      graphics.lineTo(to.x, to.y);\n      graphics.closePath();\n\n      var angle = _util2.default.to_polar_coords(from.x - to.x, from.y - to.y).angle;\n      var p1 = _util2.default.from_polar_coords(angle - _util2.default.radians(15), 7 * line_width);\n      var p2 = _util2.default.from_polar_coords(angle + _util2.default.radians(15), 7 * line_width);\n      graphics.beginFill(_color2.default.to_pixi(color));\n      graphics.moveTo(p1.x + to.x, p1.y + to.y);\n      graphics.lineTo(to.x, to.y);\n      graphics.lineTo(p2.x + to.x, p2.y + to.y);\n      graphics.closePath();\n      graphics.endFill();\n    }\n  }, {\n    key: \"draw_smoothed_polygon\",\n    value: function draw_smoothed_polygon(graphics, polygon, center, water_color) {\n      polygon = polygon.map(function (node) {\n        return _util2.default.move_by_vector(node, center, _util2.default.rand_float(0.1, 0.3));\n      });\n      var mid_radius = polygon.reduce(function (sum, e) {\n        return sum + _util2.default.distance(e, center);\n      }, 0) / polygon.length;\n      polygon = polygon.filter(function (node, i) {\n        var next_i = i + 1 == polygon.length ? 0 : i + 1;\n        var next_node = polygon[next_i];\n        return _util2.default.distance(node, next_node) >= 0.2 * mid_radius;\n      });\n\n      graphics.beginFill(_color2.default.to_pixi(water_color));\n      var fl_mid = { x: (polygon[0].x + _util2.default.last(polygon).x) / 2, y: (polygon[0].y + _util2.default.last(polygon).y) / 2 };\n      graphics.moveTo(fl_mid.x, fl_mid.y);\n      _util2.default.for_all_consecutive_pairs(polygon, function (cur, next) {\n        var pc_mid = { x: (next.x + cur.x) / 2, y: (next.y + cur.y) / 2 };\n        graphics.quadraticCurveTo(cur.x, cur.y, pc_mid.x, pc_mid.y);\n      });\n      graphics.endFill();\n    }\n  }, {\n    key: \"draw_broken_line_between_two_cells\",\n    value: function draw_broken_line_between_two_cells(c1, c2, graphics, diagram, color) {\n      var width = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 1;\n\n      var mid_point = MapDrawer.two_cells_edge_midpoint(diagram, c1, c2);\n      graphics.lineStyle(width, _color2.default.to_pixi(color));\n      graphics.moveTo(c1.x, c1.y);\n      graphics.lineTo(mid_point.x, mid_point.y);\n      graphics.moveTo(mid_point.x, mid_point.y);\n      graphics.lineTo(c2.x, c2.y);\n    }\n  }, {\n    key: \"two_cells_edge_midpoint\",\n    value: function two_cells_edge_midpoint(diagram, c1, c2) {\n      var my_edge = void 0;\n      for (var i in c2.halfedges) {\n        var edge = diagram.edges[c2.halfedges[i]];\n        if (edge.left == c1 || edge.right == c1) {\n          my_edge = edge;\n          break;\n        }\n      }\n      if (!my_edge) {\n        console.log('two_cells_edge_midpoint not linked cells', c1, c2);\n        throw 'two_cells_edge_midpoint not linked cells';\n      }\n      return { x: (my_edge.from.x + my_edge.to.x) / 2, y: (my_edge.from.y + my_edge.to.y) / 2 };\n    }\n  }]);\n\n  return MapDrawer;\n}();\n\nexports.default = MapDrawer;\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require('common/util');\n\nvar _util2 = _interopRequireDefault(_util);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar RegionsGatherer = function () {\n  function RegionsGatherer() {\n    _classCallCheck(this, RegionsGatherer);\n  }\n\n  _createClass(RegionsGatherer, null, [{\n    key: 'gather_regions',\n    value: function gather_regions(diagram) {\n      var regions_mode = 'rrt_leafs'; // 'closest'\n      var regions_min_cells = 5;\n      //const regions_opt_cells = 15; // kinda optimum, not max\n\n      // gather regions\n      diagram.regions = [];\n      if (regions_mode == 'rrt_leafs') {\n        var starters = diagram.cells.filter(function (cell) {\n          return cell.rrt_links.length != 2;\n        });\n        starters.forEach(function (cell) {\n          var region = { color: MapDrawer.random_color(), cells: [cell] };\n          diagram.regions.push(region);\n          cell.region = region;\n        });\n        starters.forEach(function (cell) {\n          return RegionsGatherer.gather_all_parents_to_my_region(cell);\n        });\n        RegionsGatherer.recursively_merge_small_regions(diagram);\n        diagram.regions.forEach(function (region, i) {\n          return region.index = i;\n        });\n      } else {\n        var get_linked_cells_func = void 0;\n        if (regions_mode == 'closest') {\n          get_linked_cells_func = function get_linked_cells_func(cell) {\n            return cell.closest_backlinks.concat([cell.closest_link]);\n          };\n        } else if (regions_mode == 'rrt') {\n          get_linked_cells_func = function get_linked_cells_func(cell) {\n            return cell.rrt_links;\n          };\n        } else if (regions_mode == 'rrt_generations') {\n          var generations_per_regions = 5;\n          get_linked_cells_func = function get_linked_cells_func(cell) {\n            var my_region_index = Math.floor(cell.generation / generations_per_regions);\n            return cell.rrt_links.filter(function (link) {\n              return Math.floor(link.generation / generations_per_regions) == my_region_index;\n            });\n          };\n        } else {\n          throw \"unknown regions_mode: \" + regions_mode;\n        }\n        diagram.cells.forEach(function (cell) {\n          return RegionsGatherer.diagram_collect_regions(diagram, cell, get_linked_cells_func);\n        });\n      }\n\n      // after set cells on_border prop\n      diagram.regions.forEach(function (region) {\n        region.on_border = false;\n        for (var i = 0; i < region.cells.length; i++) {\n          if (region.cells[i].on_border) {\n            region.on_border = true;\n            break;\n          }\n        }\n      });\n    }\n  }, {\n    key: 'diagram_collect_regions',\n    value: function (_diagram_collect_regions) {\n      function diagram_collect_regions(_x, _x2, _x3) {\n        return _diagram_collect_regions.apply(this, arguments);\n      }\n\n      diagram_collect_regions.toString = function () {\n        return _diagram_collect_regions.toString();\n      };\n\n      return diagram_collect_regions;\n    }(function (diagram, cell, get_linked_cells_func) {\n      if (cell.region) {\n        return;\n      }\n      var linked_cells = get_linked_cells_func(cell); // cell.closest_backlinks.concat([cell.closest_link]);\n      var region = void 0;\n      for (var i = 0; i < linked_cells.length; i++) {\n        if (linked_cells[i].region) {\n          region = linked_cells[i].region;\n          break;\n        }\n      }\n      if (!region) {\n        region = { color: MapDrawer.random_color(), index: diagram.regions.length, cells: [] };\n        diagram.regions.push(region);\n      }\n      cell.region = region; // index?\n      region.cells.push(cell); // wont be dublicates???\n\n      linked_cells.forEach(function (link) {\n        return diagram_collect_regions(diagram, cell, get_linked_cells_func);\n      });\n    })\n  }, {\n    key: 'gather_all_parents_to_my_region',\n    value: function gather_all_parents_to_my_region(cell) {\n      var parent = RRTDiagram.get_parent(cell);\n      if (!parent || parent.region) {\n        return;\n      }\n      parent.region = cell.region;\n      cell.region.cells.push(parent);\n      return RegionsGatherer.gather_all_parents_to_my_region(parent);\n    }\n  }, {\n    key: 'rrt_leafs_move_all_cells_from_region_to_another_and_delete_it',\n    value: function rrt_leafs_move_all_cells_from_region_to_another_and_delete_it(from, to, diagram) {\n      from.cells.forEach(function (cell) {\n        cell.region = to;\n        to.cells.push(cell);\n      });\n      from.cells.splice(0, from.cells.length);\n      _util2.default.remove_element(from, diagram.regions);\n    }\n  }, {\n    key: 'recursively_merge_small_regions',\n    value: function recursively_merge_small_regions(diagram) {\n      var small_regions = diagram.regions.filter(function (region) {\n        return region.cells.length < regions_min_cells;\n      });\n      if (!small_regions.length) {\n        return;\n      }\n      // smallest first. actually, we need only first one\n      var region = RegionsGatherer.sort_regions_by_size(small_regions)[0]; //small_regions.shift();\n      var linked_regions = RegionsGatherer.gather_all_linked_regions(region);\n      RegionsGatherer.sort_regions_by_size(linked_regions);\n      var target_region = linked_regions[0];\n      /*if (target_region.cells.length > regions_opt_cells) {\n        console.log('too bad merge with big one, size '+region.cells.length+' with size '+target_region.cells.length);\n      }*/\n      RegionsGatherer.rrt_leafs_move_all_cells_from_region_to_another_and_delete_it(region, target_region, diagram);\n      RegionsGatherer.recursively_merge_small_regions(diagram);\n    }\n  }, {\n    key: 'gather_all_linked_regions',\n    value: function gather_all_linked_regions(region) {\n      var linked_regions = [];\n      region.cells.forEach(function (cell) {\n        cell.rrt_links.forEach(function (link) {\n          if (link.region && link.region != region) _util2.default.push_uniq(link.region, linked_regions);\n        });\n      });\n      return linked_regions;\n    }\n  }, {\n    key: 'sort_regions_by_size',\n    value: function sort_regions_by_size(regions) {\n      return regions.sort(function (e1, e2) {\n        return e1.cells.length - e2.cells.length;\n      });\n    }\n  }]);\n\n  return RegionsGatherer;\n}();\n\nexports.default = RegionsGatherer;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _rrt_diagram = require(\"geo/rrt_diagram\");\n\nvar _rrt_diagram2 = _interopRequireDefault(_rrt_diagram);\n\nvar _map_drawer = require(\"geo/map_drawer\");\n\nvar _map_drawer2 = _interopRequireDefault(_map_drawer);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/**\n *  generates rivers on graph\n */\nvar RiversAndLakesGenerator = function () {\n  function RiversAndLakesGenerator() {\n    _classCallCheck(this, RiversAndLakesGenerator);\n  }\n\n  _createClass(RiversAndLakesGenerator, null, [{\n    key: \"generate_by_edges\",\n    value: function generate_by_edges(diagram) {\n      var dry_factor = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0.5;\n\n      // only edges between non-linked rrt nodes\n      var edges = diagram.edges.filter(function (edge) {\n        if (!edge.right) return false;\n        var rrt_linked = _rrt_diagram2.default.check_linked(edge.right, edge.left);\n        var sea_side = edge.right.geo_type == 'sea' || edge.left.geo_type == 'sea';\n        return !rrt_linked && !sea_side;\n      });\n      // gather river nodes and links between them\n      var nodes = [],\n          river_roots = [],\n          river_ends = [];\n      // here we only gather links between nodes, nothing more\n      edges.forEach(function (edge) {\n        _util2.default.for_all_consecutive_pairs([edge.from, edge.to], function (node, link) {\n          _util2.default.push_uniq(node, nodes);\n          if (!node.river_links) node.river_links = [];\n          _util2.default.push_uniq(link, node.river_links);\n        });\n      });\n      // here we create rivers from river root nodes, add them to closed list, all others go to open list\n      nodes.forEach(function (node) {\n        node.river = {\n          strength: 0,\n          parents: [],\n          children: []\n        };\n        if (node.on_border) {\n          river_ends.push(node);\n        } else if (node.cells.some(function (cell) {\n          return cell.geo_type == 'sea';\n        })) {\n          river_ends.push(node);\n        } else if (node.river_links.length == 1) {\n          node.river.strength = Math.random() > dry_factor ? _util2.default.rand(1, 10) : 0, river_roots.push(node);\n        } else {}\n      });\n\n      river_ends.forEach(function (node) {\n        RiversAndLakesGenerator.recursively_walk_from_ends(node, null);\n      });\n\n      river_roots.forEach(function (node) {\n        return RiversAndLakesGenerator.recursively_add_strength(node, node.river.strength);\n      });\n\n      // here we only delete temporary river_links prop!\n      nodes.forEach(function (node) {\n        return delete node.river_links;\n      });\n\n      return true;\n    }\n  }, {\n    key: \"recursively_walk_from_ends\",\n    value: function recursively_walk_from_ends(node, from) {\n      if (from) {\n        _util2.default.remove_element(node, from.river.children);\n        from.river.parents.push(node);\n        _util2.default.remove_element(from, node.river.parents);\n        node.river.children.push(from);\n      }\n      var all_but_from = node.river_links.filter(function (l) {\n        return l != from;\n      });\n      if (all_but_from.length > 1 && all_but_from.every(function (link) {\n        return link.river.children.length;\n      })) {\n        return;\n      }\n      all_but_from.forEach(function (link) {\n        RiversAndLakesGenerator.recursively_walk_from_ends(link, node);\n      });\n    }\n  }, {\n    key: \"recursively_add_strength\",\n    value: function recursively_add_strength(node, strength) {\n      node.river.children.forEach(function (child) {\n        child.river.strength += strength;\n        RiversAndLakesGenerator.recursively_add_strength(child, strength);\n      });\n    }\n  }]);\n\n  return RiversAndLakesGenerator;\n}();\n\nexports.default = RiversAndLakesGenerator;\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require('common/util');\n\nvar _util2 = _interopRequireDefault(_util);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar RRTNode = function RRTNode(x, y) {\n  _classCallCheck(this, RRTNode);\n\n  this.x = x;\n  this.y = y;\n  this.rrt_links = [];\n  this.generation = null;\n  this.branch_order = null;\n};\n\nvar RRTDiagram = function () {\n  function RRTDiagram(x_size, y_size) {\n    _classCallCheck(this, RRTDiagram);\n\n    this.nodes = [];\n    this.x_size = x_size;\n    this.y_size = y_size;\n  }\n\n  _createClass(RRTDiagram, [{\n    key: 'get_generation',\n    value: function get_generation(generation) {\n      return this.nodes.filter(function (node) {\n        return node.generation == generation;\n      });\n    }\n  }, {\n    key: 'generations_count',\n    value: function generations_count() {\n      return _util2.default.find_min_and_max(this.nodes, function (node) {\n        return node.generation;\n      }).max;\n    }\n  }, {\n    key: 'generate',\n\n\n    // TODO\n    value: function generate(epsilon) {\n      var count = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Infinity;\n      var reject_limit = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 500;\n\n      this.epsilon = epsilon; // for rrt_links rebuild\n      this.nodes.push(new RRTNode(_util2.default.rand(1, this.x_size - 1), _util2.default.rand(1, this.y_size - 1)));\n      if (count < 0) {\n        throw 'bad number of nodes given: ' + count;\n      }\n      var reject_counter = 0;\n\n      while (count && reject_counter < reject_limit) {\n        var random = { x: _util2.default.rand(1, this.x_size - 1), y: _util2.default.rand(1, this.y_size - 1) },\n            nearest = RRTDiagram.find_nearest_node(random, this.nodes),\n\n        // we calc distance second time, but i dont care...\n        distance = RRTDiagram.distance(random, nearest);\n        // distance === 0 -- if we choosed existing point\n        if (distance < epsilon * epsilon || distance === 0) {\n          reject_counter++;\n          continue;\n        }\n        var theta = Math.atan2(random.y - nearest.y, random.x - nearest.x);\n        var node = new RRTNode(Math.round(nearest.x + epsilon * Math.cos(theta)), Math.round(nearest.y + epsilon * Math.sin(theta)));\n        this.nodes.push(node);\n        RRTDiagram.link_two_nodes(node, nearest);\n        reject_counter = 0;\n        count--;\n      }\n      this.calc_branches_length_and_generations();\n    }\n\n    // TODO move it to Util?\n\n  }, {\n    key: 'remove_some_links_and_recalc_all',\n    value: function remove_some_links_and_recalc_all(count, min, max) {\n      var nodes_to_process = this.nodes.filter(function (node) {\n        return node.branch_order >= min && node.branch_order <= max;\n      });\n      if (nodes_to_process.length < count) {\n        throw 'cant remove_some_links_and_recalc_all() count ' + count + ' cause only ' + nodes_to_process.length + ' sutable nodes';\n      }\n      nodes_to_process.sort(function () {\n        return .5 - Math.random();\n      });\n      var deleted_links = [];\n      for (var i = 0; i < count; i++) {\n        var from = nodes_to_process[i];\n        var to = from.rrt_links.find(function (link) {\n          return link.branch_order >= min - 1 && link.branch_order <= max + 1;\n        });\n        if (!to) {\n          throw 'strange, not found sutable link';\n        }\n        RRTDiagram.delink_two_nodes(from, to);\n        deleted_links.push([from, to]);\n      }\n      this.calc_branches_length_and_generations();\n      return deleted_links;\n    }\n  }, {\n    key: 'restore_removed_links',\n    value: function restore_removed_links(deleted_links) {\n      deleted_links.forEach(function (_ref) {\n        var _ref2 = _slicedToArray(_ref, 2),\n            from = _ref2[0],\n            to = _ref2[1];\n\n        return RRTDiagram.link_two_nodes(from, to);\n      });\n      this.calc_branches_length_and_generations();\n    }\n  }, {\n    key: 'calc_branches_length_and_generations',\n    value: function calc_branches_length_and_generations() {\n      var _this = this;\n\n      // reset all prev values\n      this.nodes.forEach(function (node) {\n        node.generation = null;\n        node.branch_order = null;\n        node.longest_branch = null;\n      });\n\n      this.nodes.forEach(function (node) {\n        node.branch_length = 0;\n        _this.recursively_set_branch_length(node);\n        node.longest_branch = _util2.default.find_min_and_max(_this.nodes, function (e) {\n          return e.branch_length;\n        }).max;\n        _this.nodes.forEach(function (e) {\n          return delete e.branch_length;\n        });\n      });\n\n      // we choose local minimum nodes (by longest_branch) and they would be our diagram's \"centers\"\n      var centers = [];\n      this.nodes.forEach(function (node) {\n        var local_minimum = node.rrt_links.every(function (link) {\n          return link.longest_branch >= node.longest_branch;\n        });\n        var no_center_nearby = node.rrt_links.every(function (link) {\n          return centers.indexOf(link) == -1;\n        });\n        if (local_minimum && no_center_nearby) centers.push(node);\n      });\n      // and write path length from it to each node\n      this.nodes.forEach(function (node) {\n        return node.generation = null;\n      });\n      centers.forEach(function (center) {\n        center.generation = 0;\n        _this.recursively_set_generation(center);\n      });\n      // calc branch_order ONLY after calc generations\n      // FIXME sometimes diff between center and some near node is 2\n      var leaf_nodes = this.nodes.filter(function (node) {\n        return node.rrt_links.length == 1;\n      });\n      leaf_nodes.forEach(function (node) {\n        node.branch_order = 0;\n        _this.recursively_calc_branch_order(node);\n      });\n    }\n  }, {\n    key: 'recursively_set_generation',\n    value: function recursively_set_generation(node) {\n      var _this2 = this;\n\n      var filtered = node.rrt_links.filter(function (link) {\n        return link.generation == null;\n      });\n      // we set link.generation and add them to closed list\n      filtered.forEach(function (link) {\n        return link.generation = node.generation + 1;\n      });\n      // and AFTER we call recursively_set_generation on it!\n      filtered.forEach(function (link) {\n        return _this2.recursively_set_generation(link);\n      });\n    }\n\n    // TODO too bad its absolutely like recursively_set_generation()\n\n  }, {\n    key: 'recursively_set_branch_length',\n    value: function recursively_set_branch_length(node) {\n      var _this3 = this;\n\n      var filtered = node.rrt_links.filter(function (link) {\n        return link.branch_length == null;\n      });\n      filtered.forEach(function (link) {\n        return link.branch_length = node.branch_length + 1;\n      });\n      filtered.forEach(function (link) {\n        return _this3.recursively_set_branch_length(link);\n      });\n    }\n  }, {\n    key: 'recursively_calc_branch_order',\n    value: function recursively_calc_branch_order(node) {\n      var _this4 = this;\n\n      // link.generation != 0 -- diagram 'center' nodes work like 'stops'\n      var filtered = node.rrt_links.filter(function (link) {\n        var parent = link.generation < node.generation;\n        var lesser_branch_order = link.branch_order == null || link.branch_order < node.branch_order + 1;\n        return parent && lesser_branch_order;\n      });\n      if (filtered.length > 1) {\n        throw 'seens like several parents';\n      }\n      filtered.forEach(function (link) {\n        return link.branch_order = node.branch_order + 1;\n      });\n      filtered.forEach(function (link) {\n        return _this4.recursively_calc_branch_order(link);\n      });\n    }\n  }], [{\n    key: 'check_linked',\n    value: function check_linked(n1, n2) {\n      return n1.rrt_links.indexOf(n2) != -1;\n    }\n  }, {\n    key: 'find_nearest_node',\n    value: function find_nearest_node(target, nodes) {\n      if (!nodes[0]) {\n        throw 'no nodes';\n      }\n      var nearest = nodes[0],\n          nearestDistance = RRTDiagram.distance(target, nearest);\n      for (var i in nodes) {\n        var d = RRTDiagram.distance(nodes[i], target);\n        if (d < nearestDistance) {\n          nearest = nodes[i];\n          nearestDistance = d;\n        }\n      }\n      return nearest;\n    }\n\n    // PRIVATE\n\n  }, {\n    key: 'link_two_nodes',\n    value: function link_two_nodes(n1, n2) {\n      _util2.default.push_uniq(n1, n2.rrt_links);\n      _util2.default.push_uniq(n2, n1.rrt_links);\n    }\n\n    // PRIVATE\n\n  }, {\n    key: 'delink_two_nodes',\n    value: function delink_two_nodes(n1, n2) {\n      _util2.default.remove_element(n1, n2.rrt_links);\n      _util2.default.remove_element(n2, n1.rrt_links);\n    }\n  }, {\n    key: 'get_parent',\n    value: function get_parent(node) {\n      var ret = node.rrt_links.filter(function (n) {\n        return n.generation < node.generation;\n      });\n      if (!ret.length) return null; // historically it is null\n      if (ret.length != 1) {\n        console.log('more than one parent', node);\n        throw 'more than one parent';\n      }\n      return ret[0];\n    }\n\n    // PRIVATE\n\n  }, {\n    key: 'distance',\n    value: function distance(a, b) {\n      var dx = a.x - b.x,\n          dy = a.y - b.y;\n      return dx * dx + dy * dy;\n    }\n  }]);\n\n  return RRTDiagram;\n}();\n\nexports.default = RRTDiagram;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _color = require(\"common/color\");\n\nvar _color2 = _interopRequireDefault(_color);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar TextureGenerator = function () {\n  function TextureGenerator() {\n    _classCallCheck(this, TextureGenerator);\n  }\n\n  _createClass(TextureGenerator, [{\n    key: \"simple\",\n    value: function simple(base) {\n      return this.generate(base, 400, 2);\n    }\n  }, {\n    key: \"generate\",\n    value: function generate(base, tiles_count, tile_size) {\n      var graphics = new PIXI.Graphics();\n      for (var y = 0; y < tiles_count; y++) {\n        for (var x = 0; x < tiles_count; x++) {\n          graphics.beginFill(_color2.default.to_pixi(_color2.default.random_near(base)));\n          graphics.drawRect(tile_size * x, tile_size * y, tile_size, tile_size);\n          graphics.endFill();\n        }\n      }\n      var texture = graphics.generateCanvasTexture(PIXI.SCALE_MODES.NEAREST, 1);\n      return texture;\n    }\n  }]);\n\n  return TextureGenerator;\n}();\n\nexports.default = TextureGenerator;\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _collapsible_panel = require('common/components/collapsible_panel');\n\nvar _collapsible_panel2 = _interopRequireDefault(_collapsible_panel);\n\nvar _debug_info = require('planets/components/debug_info');\n\nvar _debug_info2 = _interopRequireDefault(_debug_info);\n\nvar _generate_world_form = require('planets/components/generate_world_form');\n\nvar _generate_world_form2 = _interopRequireDefault(_generate_world_form);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar App = function (_React$Component) {\n  _inherits(App, _React$Component);\n\n  function App() {\n    _classCallCheck(this, App);\n\n    return _possibleConstructorReturn(this, (App.__proto__ || Object.getPrototypeOf(App)).apply(this, arguments));\n  }\n\n  _createClass(App, [{\n    key: 'render',\n    value: function render() {\n      return _react2.default.createElement(\n        'table',\n        { style: { margin: '5px', borderSpacing: '5px', borderCollapse: 'separate' } },\n        _react2.default.createElement(\n          'tbody',\n          null,\n          _react2.default.createElement(\n            'tr',\n            { style: { verticalAlign: 'top' } },\n            _react2.default.createElement(\n              'td',\n              null,\n              _react2.default.createElement(\n                'div',\n                { className: 'panel-group' },\n                _react2.default.createElement(\n                  'div',\n                  { className: 'panel panel-success' },\n                  _react2.default.createElement(\n                    'div',\n                    { className: 'panel-body' },\n                    _react2.default.createElement(\n                      'div',\n                      { className: '', id: 'map_container' },\n                      _react2.default.createElement('canvas', { id: 'map', width: '800', height: '800' })\n                    )\n                  )\n                ),\n                _react2.default.createElement(_collapsible_panel2.default, { header: 'debug', name: 'debug', content_func: function content_func() {\n                    return _react2.default.createElement(_debug_info2.default);\n                  } })\n              )\n            ),\n            _react2.default.createElement(\n              'td',\n              { width: '100%' },\n              _react2.default.createElement(\n                'div',\n                { className: 'panel-group' },\n                _react2.default.createElement(\n                  'div',\n                  { className: 'panel panel-success' },\n                  _react2.default.createElement(\n                    'div',\n                    { className: 'panel-body' },\n                    _react2.default.createElement(_collapsible_panel2.default, { header: 'world generating', name: 'generate_world', content_func: function content_func() {\n                        return _react2.default.createElement(_generate_world_form2.default);\n                      } })\n                  ),\n                  _react2.default.createElement('div', { className: 'panel-footer' })\n                )\n              )\n            )\n          )\n        )\n      );\n    }\n  }]);\n\n  return App;\n}(_react2.default.Component);\n\nexports.default = App;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = require(\"react\");\n\nvar _react2 = _interopRequireDefault(_react);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar DebugInfo = function (_React$Component) {\n  _inherits(DebugInfo, _React$Component);\n\n  function DebugInfo() {\n    _classCallCheck(this, DebugInfo);\n\n    return _possibleConstructorReturn(this, (DebugInfo.__proto__ || Object.getPrototypeOf(DebugInfo)).apply(this, arguments));\n  }\n\n  _createClass(DebugInfo, [{\n    key: \"render\",\n    value: function render() {\n      return _react2.default.createElement(\n        \"div\",\n        null,\n        _react2.default.createElement(\n          \"div\",\n          null,\n          \"FPS: \",\n          _react2.default.createElement(\"span\", { id: \"fps_counter\" })\n        ),\n        _react2.default.createElement(\n          \"div\",\n          null,\n          \"map scale: \",\n          _react2.default.createElement(\"span\", { id: \"map_scale\" })\n        ),\n        _react2.default.createElement(\n          \"div\",\n          null,\n          \"mouse position: \",\n          _react2.default.createElement(\n            \"span\",\n            { id: \"mouse_pos\" },\n            (0, 0)\n          )\n        ),\n        _react2.default.createElement(\n          \"div\",\n          null,\n          \"world point: \",\n          _react2.default.createElement(\n            \"span\",\n            { id: \"world_pos\" },\n            (0, 0)\n          )\n        )\n      );\n    }\n  }]);\n\n  return DebugInfo;\n}(_react2.default.Component);\n\nexports.default = DebugInfo;\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _input_spinner = require('common/components/input_spinner');\n\nvar _input_spinner2 = _interopRequireDefault(_input_spinner);\n\nvar _game = require('planets/game');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar GenerateWorldForm = function (_React$Component) {\n  _inherits(GenerateWorldForm, _React$Component);\n\n  function GenerateWorldForm() {\n    _classCallCheck(this, GenerateWorldForm);\n\n    return _possibleConstructorReturn(this, (GenerateWorldForm.__proto__ || Object.getPrototypeOf(GenerateWorldForm)).apply(this, arguments));\n  }\n\n  _createClass(GenerateWorldForm, [{\n    key: 'submit',\n    value: function submit(e) {\n      e.preventDefault();\n      console.clear();\n      _game.game.map_drawer.map.stage.children.forEach(function (layer) {\n        return layer.removeChildren();\n      });\n      _game.game.generate_world();\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      return _react2.default.createElement(\n        'div',\n        null,\n        _react2.default.createElement(\n          'form',\n          { className: 'form-horizontal' },\n          _react2.default.createElement(\n            'div',\n            { className: 'form-group' },\n            _react2.default.createElement(\n              'div',\n              { className: 'col-sm-offset-4 col-sm-8' },\n              _react2.default.createElement(\n                'button',\n                { type: 'button', className: 'btn btn-default', id: 'generate_world', onClick: this.submit.bind(this) },\n                'generate'\n              )\n            )\n          )\n        )\n      );\n    }\n  }]);\n\n  return GenerateWorldForm;\n}(_react2.default.Component);\n\nexports.default = GenerateWorldForm;\n","\"use strict\";\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _star_system = require(\"planets/star_system\");\n\nvar _star_system2 = _interopRequireDefault(_star_system);\n\nvar _interaction = require(\"planets/interaction\");\n\nvar _interaction2 = _interopRequireDefault(_interaction);\n\nvar _map_drawer = require(\"planets/map_drawer\");\n\nvar _map_drawer2 = _interopRequireDefault(_map_drawer);\n\nvar _app = require(\"planets/components/app\");\n\nvar _app2 = _interopRequireDefault(_app);\n\nvar _reactDom = require(\"react-dom\");\n\nvar _reactDom2 = _interopRequireDefault(_reactDom);\n\nvar _react = require(\"react\");\n\nvar _react2 = _interopRequireDefault(_react);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Game = function () {\n  function Game() {\n    _classCallCheck(this, Game);\n\n    // CONST\n    this.width = 800;\n    this.height = 800;\n\n    this.map_drawer = new _map_drawer2.default();\n    this.interaction = new _interaction2.default();\n  }\n\n  _createClass(Game, [{\n    key: \"generate_world\",\n    value: function generate_world() {\n      this.star_system = new _star_system2.default();\n      this.star_system.generate();\n\n      this.ticks = 0;\n\n      this.map_drawer.init(this.width, this.height);\n      this.interaction.init();\n\n      this.map_drawer.map.ticker.add(this.handle_tick.bind(this));\n\n      this.map_drawer.init_graphics();\n    }\n  }, {\n    key: \"handle_tick\",\n    value: function handle_tick() {\n      this.ticks++;\n      this.star_system.tick();\n      this.map_drawer.redraw();\n    }\n  }]);\n\n  return Game;\n}();\n\nvar game = new Game();\nmodule.exports.game = game;\n\ndocument.addEventListener('DOMContentLoaded', function () {\n  _reactDom2.default.render(_react2.default.createElement(_app2.default, null), document.querySelector('#app'));\n  game.generate_world();\n});\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _game = require(\"planets/game\");\n\nvar _d = require(\"d3\");\n\nvar d3 = _interopRequireWildcard(_d);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Interaction = function () {\n  function Interaction() {\n    _classCallCheck(this, Interaction);\n\n    this.state = 'initial';\n  }\n\n  _createClass(Interaction, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      this.game = _game.game;\n      this.map = this.game.map_drawer.map;\n      this.map.stage.interactive = true;\n\n      document.addEventListener('mousemove', this.map_mouse_move_handler.bind(this), false);\n\n      d3.select('#map').on('click', this.map_click_handler.bind(this));\n\n      // from https://bl.ocks.org/pkerpedjiev/cf791db09ebcabaec0669362f4df1776\n      d3.select('#map').call(d3.zoom().scaleExtent([1, 4]).translateExtent([[0, 0], [this.map.view.width, this.map.view.height]]).on(\"zoom\", this.map_zoom.bind(this)));\n\n      this.ticks = 0; // here?\n      this.fps_div = document.getElementById('fps_counter');\n      this.map.ticker.add(function () {\n        _this.ticks++;\n        if (_this.ticks % 10 == 0) {\n          d3.select('#fps_counter').html(_this.map.ticker.FPS | 0);\n        }\n      });\n      this.update_map_scale();\n    }\n  }, {\n    key: \"map_mouse_move_handler\",\n    value: function map_mouse_move_handler(event) {\n      if (event.target != this.map.view) {\n        //this.game.map_drawer.clear_cell_under_cursor();\n        //this.cell_under_cursor = null;\n        return false;\n      }\n      var mouse_coords = this.get_mouse_coords(event);\n\n      d3.select('#mouse_pos').html('{x: ' + mouse_coords.x + ', y: ' + mouse_coords.y + '}');\n      var world_pos = this.mouse_coords_to_world_coords(mouse_coords);\n      d3.select('#world_pos').html('{x: ' + world_pos.x + ', y: ' + world_pos.y + '}');\n    }\n  }, {\n    key: \"map_click_handler\",\n    value: function map_click_handler() {\n      var mouse_coords = this.get_mouse_coords(d3.event);\n    }\n  }, {\n    key: \"map_zoom\",\n    value: function map_zoom() {\n      this.map.stage.position.x = d3.event.transform.x;\n      this.map.stage.position.y = d3.event.transform.y;\n      this.map.stage.scale.x = d3.event.transform.k;\n      this.map.stage.scale.y = d3.event.transform.k;\n      this.update_map_scale();\n    }\n    ///////////////////////////////////////\n\n\n  }, {\n    key: \"update_map_scale\",\n    value: function update_map_scale() {\n      d3.select('#map_scale').html('{x: ' + this.map.stage.scale.x + ', y: ' + this.map.stage.scale.y + '}');\n    }\n\n    ///////////////////////////////////////  \n    // UTILS\n    ///////////////////////////////////////\n\n  }, {\n    key: \"get_mouse_coords\",\n    value: function get_mouse_coords(event) {\n      return { x: event.offsetX, y: event.offsetY };\n    }\n  }, {\n    key: \"mouse_coords_to_world_coords\",\n    value: function mouse_coords_to_world_coords(mouse_coords) {\n      var xn = Math.floor((mouse_coords.x - this.map.stage.position.x) / this.map.stage.scale.x),\n          yn = Math.floor((mouse_coords.y - this.map.stage.position.y) / this.map.stage.scale.y);\n      return { x: xn, y: yn };\n    }\n  }]);\n\n  return Interaction;\n}();\n\nexports.default = Interaction;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _color = require(\"common/color\");\n\nvar _color2 = _interopRequireDefault(_color);\n\nvar _game = require(\"planets/game\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar MapDrawer = function () {\n  function MapDrawer() {\n    _classCallCheck(this, MapDrawer);\n  }\n\n  _createClass(MapDrawer, [{\n    key: \"init\",\n    value: function init(width, height) {\n      var _this = this;\n\n      var PIXI = require('pixi.js');\n      this.map = new PIXI.Application(width, height, {\n        backgroundColor: _color2.default.to_pixi([0, 0, 0]),\n        antialias: true,\n        view: document.getElementById('map')\n      });\n      console.log('renderer', this.map.renderer);\n\n      this.base_container = new PIXI.Container();\n      this.base_container.scale = { x: 6, y: 6 };\n      this.map.stage.addChild(this.base_container);\n      this.base_container.position.x = width / 2 | 0;\n      this.base_container.position.y = height / 2 | 0;\n\n      this.layers = {};\n      MapDrawer.layers().forEach(function (layer) {\n        _this.layers[layer] = new PIXI.Container();\n        _this.base_container.addChild(_this.layers[layer]);\n      });\n      document.getElementById('map_container').appendChild(this.map.view);\n      this.bodies_graphics = [];\n    }\n  }, {\n    key: \"clear_all\",\n    value: function clear_all() {\n      this.base_container.children.forEach(function (layer) {\n        return layer.removeChildren();\n      });\n    }\n  }, {\n    key: \"init_graphics\",\n    value: function init_graphics() {\n      var _this2 = this;\n\n      this.init_stellar_body(_game.game.star_system.star);\n      _game.game.star_system.planets.forEach(function (planet) {\n        return _this2.init_stellar_body(planet);\n      });\n    }\n  }, {\n    key: \"redraw\",\n    value: function redraw() {\n      var _this3 = this;\n\n      this.bodies_graphics.forEach(function (graphics) {\n        return _this3.update_stellar_body(graphics);\n      });\n    }\n  }, {\n    key: \"init_stellar_body\",\n    value: function init_stellar_body(stellar_body) {\n      var graphics = new PIXI.Graphics();\n      graphics.backlink = stellar_body;\n\n      var line_color = _color2.default.to_pixi(_color2.default.darker(stellar_body.color, 30));\n      graphics.lineStyle(stellar_body.radius / 10, line_color);\n      graphics.beginFill(_color2.default.to_pixi(stellar_body.color));\n      graphics.drawCircle(0, 0, stellar_body.radius);\n      graphics.closePath();\n      graphics.endFill();\n\n      this.small_circle(graphics, 0, 1, stellar_body, line_color);\n      this.small_circle(graphics, 0, -1, stellar_body, line_color);\n      this.small_circle(graphics, 1, 0, stellar_body, line_color);\n      this.small_circle(graphics, -1, 0, stellar_body, line_color);\n\n      this.layers['bodies'].addChild(graphics);\n      this.bodies_graphics.push(graphics);\n      this.update_stellar_body(graphics);\n      //console.log('DI', coords, stellar_body.orbital_angle, stellar_body.orbital_radius);\n    }\n  }, {\n    key: \"update_stellar_body\",\n    value: function update_stellar_body(graphics) {\n      var stellar_body = graphics.backlink;\n      var coords = _util2.default.from_polar_coords(stellar_body.orbital_angle, stellar_body.orbital_radius);\n      //console.log('SF', coords);\n      graphics.position.x = coords.x;\n      graphics.position.y = coords.y;\n      graphics.rotation = stellar_body.angle;\n    }\n  }, {\n    key: \"small_circle\",\n    value: function small_circle(graphics, x, y, stellar_body, color) {\n      graphics.lineStyle(stellar_body.radius / 10, _color2.default.to_pixi([0, 0, 0]));\n      graphics.beginFill(color);\n      graphics.drawCircle(x * (stellar_body.radius / 2), y * (stellar_body.radius / 2), stellar_body.radius / 3);\n      graphics.endFill();\n    }\n  }], [{\n    key: \"layers\",\n    value: function layers() {\n      return ['bodies', 'errors', 'test'];\n    }\n  }]);\n\n  return MapDrawer;\n}();\n\nexports.default = MapDrawer;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _game = require(\"planets/game\");\n\nvar _stellar_body = require(\"planets/stellar_body\");\n\nvar _stellar_body2 = _interopRequireDefault(_stellar_body);\n\nvar _color = require(\"common/color\");\n\nvar _color2 = _interopRequireDefault(_color);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar StarSystem = function () {\n  function StarSystem() {\n    _classCallCheck(this, StarSystem);\n\n    this.star = null;\n    this.planets = [];\n\n    this.orbital_speed_coef = 0.0025;\n    this.rotation_speed_coef = 0.01;\n  }\n\n  _createClass(StarSystem, [{\n    key: \"generate\",\n    value: function generate() {\n      this.star = new _stellar_body2.default();\n      this.star.radius = 8;\n      this.star.rotation_speed = this.rotation_speed_coef * _util2.default.rand(1, 10);\n      this.star.color = _color2.default.random_near([250, 50, 50]);\n\n      var count_planets = 5;\n      while (count_planets--) {\n        var planet = new _stellar_body2.default();\n        planet.orbital_radius = 10 * (count_planets + 2);\n        planet.radius = _util2.default.rand(1, 5);\n        planet.orbital_speed = this.orbital_speed_coef * _util2.default.rand(1, 10);\n        planet.rotation_speed = this.rotation_speed_coef * _util2.default.rand(1, 10);\n        planet.color = _color2.default.random([200, 200, 200]);\n\n        this.planets.push(planet);\n      }\n    }\n  }, {\n    key: \"tick\",\n    value: function tick() {\n      var _this = this;\n\n      this.update_stellar_body(this.star);\n      this.planets.forEach(function (planet) {\n        return _this.update_stellar_body(planet);\n      });\n    }\n  }, {\n    key: \"update_stellar_body\",\n    value: function update_stellar_body(body) {\n      body.orbital_angle += body.orbital_speed;\n      body.angle += body.rotation_speed;\n    }\n  }]);\n\n  return StarSystem;\n}();\n\nexports.default = StarSystem;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _util = require(\"common/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _game = require(\"planets/game\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar StellarBody = function StellarBody() {\n  _classCallCheck(this, StellarBody);\n\n  this.orbital_radius = 0;\n  this.radius = 0;\n  this.orbital_speed = 0;\n  this.rotation_speed = 0;\n  // temp\n  this.color = [0, 0, 0];\n\n  this.orbital_angle = 0;\n  this.angle = 0;\n};\n\nexports.default = StellarBody;\n"]}